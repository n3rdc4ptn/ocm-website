<!doctype html><html lang=en data-bs-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href="/main.22eadac82f22d77a5ffbfd58e25e763d56d43d0560c722dbc9d65aa10ebc597bd8d0df6f9950cef232b55a2e23037ed827c7bed5c8f8cd07edfd269c414fd8de.css" integrity="sha512-IurayC8i13pf+/1Y4l52PVbUPQVgxyLbydZaoQ68WXvY0N9vmVDO8jK1Wi4jA37YJ8e+1cj4zQft/SacQU/Y3g==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://ocm.software/docs/tutorials/structuring-software-products-with-ocm/><link rel=canonical href=https://ocm.software/docs/tutorials/structuring-software-products-with-ocm/><title>Structuring Software Products with OCM | Open Component Model</title>
<meta name=description content><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:title" content="Structuring Software Products with OCM"><meta property="og:description" content="Introduction Example Helm Charts Input Specification Building the Common Transport Archive Deploying Software Localization Example Updating Components Introduction In this specification software products are comprised of logical units called components."><meta property="og:type" content="article"><meta property="og:url" content="https://ocm.software/docs/tutorials/structuring-software-products-with-ocm/"><meta property="og:image" content="https://ocm.software/logo-image.png"><meta property="article:section" content="docs"><meta property="article:published_time" content="2022-08-12T10:36:48+01:00"><meta property="article:modified_time" content="2022-08-12T10:36:48+01:00"><meta property="og:site_name" content="Open Component Model"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ocm.software/logo-image.png"><meta name=twitter:title content="Structuring Software Products with OCM"><meta name=twitter:description content="Introduction Example Helm Charts Input Specification Building the Common Transport Archive Deploying Software Localization Example Updating Components Introduction In this specification software products are comprised of logical units called components."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://ocm.software/","name":"Open Component Model","position":1},{"@type":"ListItem","item":"https://ocm.software/docs/","name":"Docs","position":2},{"@type":"ListItem","item":"https://ocm.software/docs/tutorials/","name":"Tutorials","position":3},{"@type":"ListItem","name":"Structuring Software Products With Ocm","position":4}]}</script></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand order-0" href=/ aria-label="Open Component Model"><img src=/images/logo-horizontal-white-text.png alt="Open Component Model Logo" class=header-logo>
</a><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details><summary>Overview</summary><ul class="list-unstyled list-nested"><li><a href=/docs/overview/about/>About the OCM Project</a></li><li><a href=/docs/overview/benefits-of-ocm/>Benefits of OCM</a></li><li><a href=/docs/overview/important-terms/>Important Terms</a></li><li><a href=/docs/overview/specification/>Specification</a></li></ul></details></li><li><details><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/installing-the-ocm-cli/>Installing the OCM CLI</a></li><li><a href=/docs/getting-started/first-steps-with-ocm/>First Steps with OCM</a></li></ul></details></li><li><details><summary>CLI Reference</summary><ul class="list-unstyled list-nested"><li><details><summary>add</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/add/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/add/references/>references</a></li><li><a href=/docs/cli-reference/add/resource-configuration/>resource-configuration</a></li><li><a href=/docs/cli-reference/add/resources/>resources</a></li><li><a href=/docs/cli-reference/add/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/add/source-configuration/>source-configuration</a></li><li><a href=/docs/cli-reference/add/sources/>sources</a></li></ul></details></li><li><details><summary>check</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/check/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>clean</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/clean/cache/>cache</a></li></ul></details></li><li><details><summary>create</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/create/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/create/rsakeypair/>rsakeypair</a></li><li><a href=/docs/cli-reference/create/transportarchive/>transportarchive</a></li></ul></details></li><li><details><summary>describe</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/describe/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/describe/cache/>cache</a></li><li><a href=/docs/cli-reference/describe/package/>package</a></li><li><a href=/docs/cli-reference/describe/plugins/>plugins</a></li></ul></details></li><li><details><summary>download</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/download/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/download/cli/>cli</a></li><li><a href=/docs/cli-reference/download/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/download/resources/>resources</a></li></ul></details></li><li><details><summary>get</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/get/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/get/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/get/credentials/>credentials</a></li><li><a href=/docs/cli-reference/get/plugins/>plugins</a></li><li><a href=/docs/cli-reference/get/references/>references</a></li><li><a href=/docs/cli-reference/get/resources/>resources</a></li><li><a href=/docs/cli-reference/get/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/get/sources/>sources</a></li></ul></details></li><li><details><summary>help</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/help/attributes/>attributes</a></li><li><a href=/docs/cli-reference/help/configfile/>configfile</a></li><li><a href=/docs/cli-reference/help/credential-handling/>credential-handling</a></li><li><a href=/docs/cli-reference/help/logging/>logging</a></li><li><a href=/docs/cli-reference/help/oci-references/>oci-references</a></li><li><a href=/docs/cli-reference/help/ocm-accessmethods/>ocm-accessmethods</a></li><li><a href=/docs/cli-reference/help/ocm-downloadhandlers/>ocm-downloadhandlers</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-references/>ocm-references</a></li><li><a href=/docs/cli-reference/help/ocm-uploadhandlers/>ocm-uploadhandlers</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li></ul></details></li><li><details><summary>list</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/list/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>show</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/show/tags/>tags</a></li><li><a href=/docs/cli-reference/show/versions/>versions</a></li></ul></details></li><li><details><summary>sign</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/sign/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/sign/hash/>hash</a></li></ul></details></li><li><details><summary>transfer</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/transfer/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/transfer/commontransportarchive/>commontransportarchive</a></li><li><a href=/docs/cli-reference/transfer/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/transfer/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>verify</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/verify/componentversions/>componentversions</a></li></ul></details></li></ul></details></li><li><details><summary>OCM Controllers</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/architecture/>Architecture</a></li><li><a href=/docs/controller/installation/>Installation</a></li><li><details><summary>Kubernetes Controllers</summary><ul class="list-unstyled list-nested"><li><details><summary>API Reference</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/api-reference/ocm-controller-api-v1/>OCM Controller API v1</a></li><li><a href=/docs/controller/controller-reference/api-reference/replication-controller-api-v1/>Replication Controller API v1</a></li></ul></details></li><li><details><summary>OCM Controller</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/ocm-controller/component-version/>Component Version</a></li></ul></details></li><li><details><summary>Replication Controller</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/replication-controller/component-subscription/>Component Subscription</a></li></ul></details></li></ul></details></li></ul></details></li><li><details open><summary>Tutorials</summary><ul class="list-unstyled list-nested"><li><a href=/docs/tutorials/air-gapped-gitops-with-ocm-flux/>Air-gapped GitOps with OCM & Flux</a></li><li><a href=/docs/tutorials/best-practices/>Best Practices</a></li><li><a href=/docs/tutorials/build-deploy-infrastructure-via-helm-charts-with-ocm/>Build & Deploy Infrastructure via Helm Charts with OCM</a></li><li><a href=/docs/tutorials/create-an-ocm-component-for-a-simple-application/>Create an OCM component for a simple application</a></li><li><a href=/docs/tutorials/deployment-scenario-using-an-aggregated-component/>Deployment scenario using an aggregate(d) component</a></li><li><a href=/docs/tutorials/deploying-applications-with-ocm-gitops/>Deploying Applications with OCM & GitOps</a></li><li><a href=/docs/tutorials/gitops-driven-configuration-of-ocm-applications/>GitOps Driven Configuration of OCM Applications</a></li><li><a href=/docs/tutorials/input-and-access-types/>Input and Access Types</a></li><li class=active><a aria-current=page href=/docs/tutorials/structuring-software-products-with-ocm/>Structuring Software Products with OCM</a></li></ul></details></li><li><details><summary>Examples</summary><ul class="list-unstyled list-nested"><li><a href=/docs/examples/secure-software-delivery-with-flux-and-open-component-model/>Secure software delivery with Flux and Open Component Model</a></li></ul></details></li><li><details><summary>Roadmap</summary><ul class="list-unstyled list-nested"><li><a href=/docs/roadmap/our-roadmap/>Our Roadmap</a></li></ul></details></li><li><details><summary>Support</summary><ul class="list-unstyled list-nested"><li><a href=/docs/support/how-to-get-support/>How to get Support</a></li><li><a href=/docs/support/freqently-asked-questions/>Freqently Asked Questions</a></li><li><a href=/docs/support/community/>The OCM Community</a></li></ul></details></li><li><details><summary>Contribute</summary><ul class="list-unstyled list-nested"><li><a href=/docs/contribution/contributing-guideline/>Contributing Guideline</a></li><li><a href=/docs/contribution/security-guideline/>Security Guideline</a></li></ul></details></li></ul></nav></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>Open Component Model</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://ocm.software/docs/overview/about>Project</a></li><li class=nav-item><a class=nav-link href=https://ocm.software/docs/overview/specification>Spec</a></li><li class=nav-item><a class=nav-link href=https://ocm.software/docs/support/community>Community</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/open-component-model><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://kubernetes.slack.com/archives/C05UWBE8R1D><svg role="img" width="22" height="22" viewBox="0 0 24 24" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M5.042 15.165a2.528 2.528.0 01-2.52 2.523A2.528 2.528.0 010 15.165a2.527 2.527.0 012.522-2.52h2.52v2.52zm1.271.0a2.527 2.527.0 012.521-2.52 2.527 2.527.0 012.521 2.52v6.313A2.528 2.528.0 018.834 24a2.528 2.528.0 01-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528.0 01-2.521-2.52A2.528 2.528.0 018.834.0a2.528 2.528.0 012.521 2.522v2.52H8.834zm0 1.271a2.528 2.528.0 012.521 2.521 2.528 2.528.0 01-2.521 2.521H2.522A2.528 2.528.0 010 8.834a2.528 2.528.0 012.522-2.521h6.312zM18.956 8.834a2.528 2.528.0 012.522-2.521A2.528 2.528.0 0124 8.834a2.528 2.528.0 01-2.522 2.521h-2.522V8.834zm-1.268.0a2.528 2.528.0 01-2.523 2.521 2.527 2.527.0 01-2.52-2.521V2.522A2.527 2.527.0 0115.165.0a2.528 2.528.0 012.523 2.522v6.312zM15.165 18.956a2.528 2.528.0 012.523 2.522A2.528 2.528.0 0115.165 24a2.527 2.527.0 01-2.52-2.522v-2.522h2.52zm0-1.268a2.527 2.527.0 01-2.52-2.523 2.526 2.526.0 012.52-2.52h6.313A2.527 2.527.0 0124 15.165a2.528 2.528.0 01-2.522 2.523h-6.313z"/></svg><small class="ms-2 visually-hidden">Slack</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-offset d-none d-lg-block"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details><summary>Overview</summary><ul class="list-unstyled list-nested"><li><a href=/docs/overview/about/>About the OCM Project</a></li><li><a href=/docs/overview/benefits-of-ocm/>Benefits of OCM</a></li><li><a href=/docs/overview/important-terms/>Important Terms</a></li><li><a href=/docs/overview/specification/>Specification</a></li></ul></details></li><li><details><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/installing-the-ocm-cli/>Installing the OCM CLI</a></li><li><a href=/docs/getting-started/first-steps-with-ocm/>First Steps with OCM</a></li></ul></details></li><li><details><summary>CLI Reference</summary><ul class="list-unstyled list-nested"><li><details><summary>add</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/add/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/add/references/>references</a></li><li><a href=/docs/cli-reference/add/resource-configuration/>resource-configuration</a></li><li><a href=/docs/cli-reference/add/resources/>resources</a></li><li><a href=/docs/cli-reference/add/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/add/source-configuration/>source-configuration</a></li><li><a href=/docs/cli-reference/add/sources/>sources</a></li></ul></details></li><li><details><summary>check</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/check/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>clean</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/clean/cache/>cache</a></li></ul></details></li><li><details><summary>create</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/create/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/create/rsakeypair/>rsakeypair</a></li><li><a href=/docs/cli-reference/create/transportarchive/>transportarchive</a></li></ul></details></li><li><details><summary>describe</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/describe/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/describe/cache/>cache</a></li><li><a href=/docs/cli-reference/describe/package/>package</a></li><li><a href=/docs/cli-reference/describe/plugins/>plugins</a></li></ul></details></li><li><details><summary>download</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/download/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/download/cli/>cli</a></li><li><a href=/docs/cli-reference/download/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/download/resources/>resources</a></li></ul></details></li><li><details><summary>get</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/get/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/get/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/get/credentials/>credentials</a></li><li><a href=/docs/cli-reference/get/plugins/>plugins</a></li><li><a href=/docs/cli-reference/get/references/>references</a></li><li><a href=/docs/cli-reference/get/resources/>resources</a></li><li><a href=/docs/cli-reference/get/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/get/sources/>sources</a></li></ul></details></li><li><details><summary>help</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/help/attributes/>attributes</a></li><li><a href=/docs/cli-reference/help/configfile/>configfile</a></li><li><a href=/docs/cli-reference/help/credential-handling/>credential-handling</a></li><li><a href=/docs/cli-reference/help/logging/>logging</a></li><li><a href=/docs/cli-reference/help/oci-references/>oci-references</a></li><li><a href=/docs/cli-reference/help/ocm-accessmethods/>ocm-accessmethods</a></li><li><a href=/docs/cli-reference/help/ocm-downloadhandlers/>ocm-downloadhandlers</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-references/>ocm-references</a></li><li><a href=/docs/cli-reference/help/ocm-uploadhandlers/>ocm-uploadhandlers</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li></ul></details></li><li><details><summary>list</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/list/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>show</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/show/tags/>tags</a></li><li><a href=/docs/cli-reference/show/versions/>versions</a></li></ul></details></li><li><details><summary>sign</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/sign/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/sign/hash/>hash</a></li></ul></details></li><li><details><summary>transfer</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/transfer/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/transfer/commontransportarchive/>commontransportarchive</a></li><li><a href=/docs/cli-reference/transfer/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/transfer/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>verify</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/verify/componentversions/>componentversions</a></li></ul></details></li></ul></details></li><li><details><summary>OCM Controllers</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/architecture/>Architecture</a></li><li><a href=/docs/controller/installation/>Installation</a></li><li><details><summary>Kubernetes Controllers</summary><ul class="list-unstyled list-nested"><li><details><summary>API Reference</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/api-reference/ocm-controller-api-v1/>OCM Controller API v1</a></li><li><a href=/docs/controller/controller-reference/api-reference/replication-controller-api-v1/>Replication Controller API v1</a></li></ul></details></li><li><details><summary>OCM Controller</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/ocm-controller/component-version/>Component Version</a></li></ul></details></li><li><details><summary>Replication Controller</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/replication-controller/component-subscription/>Component Subscription</a></li></ul></details></li></ul></details></li></ul></details></li><li><details open><summary>Tutorials</summary><ul class="list-unstyled list-nested"><li><a href=/docs/tutorials/air-gapped-gitops-with-ocm-flux/>Air-gapped GitOps with OCM & Flux</a></li><li><a href=/docs/tutorials/best-practices/>Best Practices</a></li><li><a href=/docs/tutorials/build-deploy-infrastructure-via-helm-charts-with-ocm/>Build & Deploy Infrastructure via Helm Charts with OCM</a></li><li><a href=/docs/tutorials/create-an-ocm-component-for-a-simple-application/>Create an OCM component for a simple application</a></li><li><a href=/docs/tutorials/deployment-scenario-using-an-aggregated-component/>Deployment scenario using an aggregate(d) component</a></li><li><a href=/docs/tutorials/deploying-applications-with-ocm-gitops/>Deploying Applications with OCM & GitOps</a></li><li><a href=/docs/tutorials/gitops-driven-configuration-of-ocm-applications/>GitOps Driven Configuration of OCM Applications</a></li><li><a href=/docs/tutorials/input-and-access-types/>Input and Access Types</a></li><li class=active><a aria-current=page href=/docs/tutorials/structuring-software-products-with-ocm/>Structuring Software Products with OCM</a></li></ul></details></li><li><details><summary>Examples</summary><ul class="list-unstyled list-nested"><li><a href=/docs/examples/secure-software-delivery-with-flux-and-open-component-model/>Secure software delivery with Flux and Open Component Model</a></li></ul></details></li><li><details><summary>Roadmap</summary><ul class="list-unstyled list-nested"><li><a href=/docs/roadmap/our-roadmap/>Our Roadmap</a></li></ul></details></li><li><details><summary>Support</summary><ul class="list-unstyled list-nested"><li><a href=/docs/support/how-to-get-support/>How to get Support</a></li><li><a href=/docs/support/freqently-asked-questions/>Freqently Asked Questions</a></li><li><a href=/docs/support/community/>The OCM Community</a></li></ul></details></li><li><details><summary>Contribute</summary><ul class="list-unstyled list-nested"><li><a href=/docs/contribution/contributing-guideline/>Contributing Guideline</a></li><li><a href=/docs/contribution/security-guideline/>Security Guideline</a></li></ul></details></li></ul></nav></div><div class="col container-fw d-lg-flex flex-lg-row justify-content-center mx-auto"><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#introduction>Introduction</a></li><li><a href=#example>Example</a><ul><li><a href=#helm-charts>Helm Charts</a></li><li><a href=#input-specification>Input Specification</a></li><li><a href=#building-the-common-transport-archive>Building the Common Transport Archive</a></li></ul></li><li><a href=#deploying-software>Deploying Software</a><ul><li><a href=#localization>Localization</a></li><li><a href=#example-1>Example</a></li></ul></li><li><a href=#updating-components>Updating Components</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Structuring Software Products with OCM</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#example>Example</a><ul><li><a href=#helm-charts>Helm Charts</a></li><li><a href=#input-specification>Input Specification</a></li><li><a href=#building-the-common-transport-archive>Building the Common Transport Archive</a></li></ul></li><li><a href=#deploying-software>Deploying Software</a><ul><li><a href=#localization>Localization</a></li><li><a href=#example-1>Example</a></li></ul></li><li><a href=#updating-components>Updating Components</a></li></ul></nav></div></details></nav><ul><li><a href=#introduction>Introduction</a></li><li><a href=#example>Example</a><ul><li><a href=#helm-charts>Helm Charts</a></li><li><a href=#input-specification>Input Specification</a></li><li><a href=#building-the-common-transport-archive>Building the Common Transport Archive</a></li></ul></li><li><a href=#deploying-software>Deploying Software</a><ul><li><a href=#localization>Localization</a></li><li><a href=#example-1>Example</a></li></ul></li><li><a href=#updating-components>Updating Components</a></li></ul><h2 id=introduction>Introduction<a href=#introduction class=anchor aria-hidden=true>#</a></h2><p>In this specification software products are comprised of logical units called
<a href=https://github.com/open-component-model/ocm-spec/blob/main/doc/01-model/02-elements-toplevel.md#components-and-component-versions><strong>components</strong></a>. A component version
consists of a set of technical <a href=https://github.com/open-component-model/ocm-spec/blob/main/doc/04-extensions/01-artifact-types/README.md>artifacts</a>,
e.g. Docker images, Helm charts, binaries, configuration data etc.
Such artifacts are called <strong>resources</strong> in this specification. Resources are usually built
from something, e.g. code in a git repo. Those are named <strong>sources</strong> in this specification.</p><p>OCM introduces a <strong>Component Descriptor</strong> for every component version, that
describes the resources, sources and other component versions belonging to a particular
component version and how to access them.</p><p>Usually however real-life applications are composed of multiple components. For
example an application might consist of a frontend, a backend, a database and a web server.
During the software development process new
<a href=https://github.com/open-component-model/ocm-spec/blob/main/doc/01-model/02-elements-toplevel.md#components-and-component-versions><strong>component versions</strong></a>
are created and third-party components might be consumed from a public registry and
updated from time to time.</p><p>Not all component version combinations of frontend, backend, database etc.are
compatible and form a valid product version. In order to define reasonable
version combinations for the software product, we could use another feature of
the <em>Component Descriptor</em>, called component reference (or reference in short) which allows
the aggregation of component versions.</p><p>For each component and each version in use there is a <em>Component Descriptor</em>. For the
entire application we introduce a new component that describes the overall software
product referencing all components. This describes the entire application.</p><p>A particular version of this application is again described by a <em>Component Descriptor</em>,
which contains references to <em>Component Descriptors</em> of its components in their version in
use. You are not restricted to this approach. It is e.g. possible to create multi-level
hierarchies or you could just maintain a list of component version combinations which build
a valid product release.</p><p>In a nutshell OCM provides a simple approach to specify what belongs to a product version.
Starting with the <em>Component Descriptor</em> for a product version and following the component
references, you could collect all artifacts, belonging to this product version.</p><h2 id=example>Example<a href=#example class=anchor aria-hidden=true>#</a></h2><p>Let&rsquo;s illustrate this idea by an example. As base we use the &lsquo;microblog&rsquo; application. This
application was created for a programming tutorial and is documented in detail
<a href=https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world>here</a>.
The source code can be found <a href=https://github.com/miguelgrinberg/microblog/>here</a>.</p><p>At the end of the tutorial this application consists of the following components:</p><ul><li>Microblog application written in Python</li><li>A database MySQL or MariaDB</li><li>A full-text search engine elasticsearch</li><li>Redis to support task queues for background processing</li><li>For a Kubernetes deployment and nginx ingress controller is needed in addition.</li></ul><p><img src=/images/example-app_hufe6371791c442b49c520b27110aced8f_68452_1600x900_resize_q85_h2_lanczos_3.webp width=1600 height=900 decoding=async fetchpriority=auto loading=lazy alt="Example Application Architecture" id=h-rh-i-0></p><p>Following the guideline above we will end-up with six component versions: Five are created
for the components in this list. And one component is created describing the application
deployment and referencing all the sub-components. Looking closer at the components we can encounter three different flavors:</p><ul><li>The deployment component describing a product release and referencing all used components</li><li>The main application component consisting of source code and to a container image.</li><li>Third party components consumed as binaries located in a public repository.</li></ul><p>For building composed components the <a href=../getting-started-with-ocm#all-in-one>&ldquo;All-in-one&rdquo;</a>
mechanism becomes handy.</p><h3 id=helm-charts>Helm Charts<a href=#helm-charts class=anchor aria-hidden=true>#</a></h3><p>Kubernetes deployments often use helm charts. The OCM specification supports helm charts as
an artifact type. For the microblog application we will create out own helm chart. For the
third-party components we will use readily available helm charts from public helm chart
repostories.</p><p>The OCM CLI supports referencing helm charts being stored in an OCI registry. However most
publicly available helm charts currently are available from helm chart repositories and
not from OCI registries. Therefore the helm charts are embedded in the component archive.
This can easily be achieved with the helm CLI:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><pre tabindex=0><code>helm repo add &lt;repo-name&gt; &lt;helm-chart-repo-url&gt;
helm pull --destination &lt;target-dir&gt; &lt;repo-name/chart-name&gt;</code></pre></figure></div><p>Example:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><pre tabindex=0><code>helm repo add bitnami https://charts.bitnami.com/bitnami
helm pull --destination . bitnami/mariadb</code></pre></figure></div><p>The helm chart for mariadb is then stored in the current working directory as <code>mariadb:11.4.5.tgz</code> and can be referenced as path from there in the <code>component-constructor.yaml</code> file (see below).</p><p>The helm chart for the microblog application is our own and part of the source code. It is
not downloaded from a public repository.</p><h3 id=input-specification>Input Specification<a href=#input-specification class=anchor aria-hidden=true>#</a></h3><p>The corresponding input file for building the component version (<code>component-constructor.yaml</code>) will then look like this:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>components</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Deployable component: microblog-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># - contains application and references all runtime dependencies</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># - used as root component to deploy the complete application</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># - version numbering scheme follows the main application</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${COMPONENT_NAME_PREFIX}/microblog-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${PROVIDER}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>componentReferences</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>ocm.software/microblog/microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>ocm.software/microblog/nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${NGINX_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>ocm.software/microblog/mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${MARIADB_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>ocm.software/microblog/elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${ELASTIC_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Main application component: microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># - has a source repository and compiles its own images</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${COMPONENT_NAME_PREFIX}/microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${PROVIDER}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>source</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>filesytem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>access</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>github</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>repoUrl</span><span class=p>:</span><span class=w> </span><span class=l>github.com/acme.org^/microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>commit</span><span class=p>:</span><span class=w> </span><span class=l>${COMMIT}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>microblog-chart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helmChart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>input</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>../microblog-helmchart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>microblog-image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociImage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>input</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>dockermulti</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class=l>microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>variants</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>microblog:${VERSION}-linux-amd64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>microblog:${VERSION}-linux-arm64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Nginx-Controller Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># - runtime dependency, use pre-built images, embeds helm chart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${COMPONENT_NAME_PREFIX}/nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${NGINX_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${PROVIDER}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-controller-chart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helmChart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>input</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>nginx/ingress-nginx-${NGINX_CHART_VERSION}.tgz</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-controller-image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociImage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${NGINX_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>access</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociArtifact</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imageReference</span><span class=p>:</span><span class=w> </span><span class=l>registry.k8s.io/ingress-nginx/controller:v${NGINX_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Maria-DB Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># - runtime dependency, use pre-built images, embeds helm chart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${COMPONENT_NAME_PREFIX}/mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${MARIADB_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${PROVIDER}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mariadb-chart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helmChart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>input</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>mariadb/mariadb-${MARIADB_CHART_VERSION}.tgz</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mariadb-image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociImage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${MARIADB_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>access</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociArtifact</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imageReference</span><span class=p>:</span><span class=w> </span><span class=l>bitnami/mariadb:${MARIADB_VERSION}-debian-11-r12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Elasticsearch Component:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># - runtime dependency, use pre-built images, embeds helm chart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${COMPONENT_NAME_PREFIX}/elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${ELASTIC_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${PROVIDER}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch-chart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helmChart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>input</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>elastic/elasticsearch-${ELASTIC_VERSION}.tgz</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch-image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociImage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>${ELASTIC_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>access</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociArtifact</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imageReference</span><span class=p>:</span><span class=w> </span><span class=l>docker.elastic.co/elasticsearch/elasticsearch:${ELASTIC_VERSION}</span></span></span></code></pre></div></figure></div><p>Some frequently changing parameters have been extracted as variables. The OCM CLI uses
templating to fill them with values. The templating mechanism is described
<a href=../best-practices-with-ocm#templating-the-resources>here</a>. For this example
we use the simple (default) template engine type <code>subst</code>.</p><p>Note the differences between the various components:</p><ul><li>The microblog-deployment is the root and contains only references to other components</li><li>The microblog application is the main application, built from sources. It has <code>sources</code>.</li><li>The microblog application consists of an image and a helm chart. The image is built in
previous build step (not described here) and taken from the local docker registry. The
two images for different architectures are converted to a multi-arch image.</li><li>All other components are third-party components and referenced from public registries.</li></ul><h3 id=building-the-common-transport-archive>Building the Common Transport Archive<a href=#building-the-common-transport-archive class=anchor aria-hidden=true>#</a></h3><p>From the input file <code>component-constructor.yaml</code> the common transport archive can be created with the
OCM CLI. For all variables we need to provide values. Variable values can be passed in the
command line or stored in a file. For many variable having a values file is more convenient.
The corresponding file <code>settings.yaml</code> may look like this:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>VERSION</span><span class=p>:</span><span class=w> </span><span class=m>0.23.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>COMMIT</span><span class=p>:</span><span class=w> </span><span class=l>5f03021059c7dbe760ac820a014a8a84166ef8b4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>NAME</span><span class=p>:</span><span class=w> </span><span class=l>microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>COMPONENT_NAME_PREFIX</span><span class=p>:</span><span class=w> </span><span class=l>github.com/acme.org/microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=l>acme.org</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ELASTIC_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>8.5.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>MARIADB_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>10.6.11</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>MARIADB_CHART_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>11.4.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>NGINX_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>1.5.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>NGINX_CHART_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>4.4.2</span></span></span></code></pre></div></figure></div><p>Create the transport archive then with:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocm add componentversions --create --file &lt;ctf-target-dir&gt; --settings settings.yaml component-constructor.yaml</span></span></code></pre></div></figure></div><p>You can view the generated component descriptor using the command:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocm get component -o yaml &lt;ctf-target-dir&gt;</span></span></code></pre></div></figure></div><p>You can store the transport archive in an OCI registry (this step needs a proper
configuration of credentials for the OCM CLI):</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocm transfer ctf -f &lt;ctf-target-dir&gt; &lt;oci-repo-url&gt;</span></span></code></pre></div></figure></div><div class="callout callout-danger d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><div class=callout-content><div class=callout-title><p>-f replaces existing component</p></div><div class=callout-body><p>Be careful with the <code>-f</code> or <code>--overwrite</code> flag. This will replace existing component
versions in the OCI registry. During development it is useful being able to overwrite
existing component versions until something is ready for release. <strong>For released versions
you should never use this flag</strong>! Released component versions should be immutable and
should never be overwritten. They serve as source of truth for what the release is made of
und should never be changed.</p></div></div></div><h2 id=deploying-software>Deploying Software<a href=#deploying-software class=anchor aria-hidden=true>#</a></h2><p>Up to now we have created a transport archive containig all required parts (images, helm charts) for
installing the application. This archive is self-contained and can be transferred with a single
command from the OCM tooling. After pushing this archive to an OCI-registry we have a shared location
that can be used as a source of deployment without any external references. As an alternative you can
transport the archive using offline mechanisms (file transfer, USB-stick) and push it on a target
location to an OCI registry.</p><p>To actually deploy the application we need to get access to the helm charts contained in the archive.
We can use the ocm CLI to retrieve their location. See the <a href=#example-1>example</a> below.</p><h3 id=localization>Localization<a href=#localization class=anchor aria-hidden=true>#</a></h3><p>The deployments in a Kubernetes cluster require an image for instantiating a container. With each
transport of the archive the image location changes. The image location can be set as a helm value
for a helm based installation. The actual value for the current deployment has to be extracted from
the component-descriptor and inserted into a helm values file for a helm based installation. In the
example below we will do the necessary steps. For real deplyoments you will usually use tools to
automate this. The <a href=https://github.com/open-component-model/ocm/blob/main/docs/reference/ocm_toi-bootstrapping.md>toi installation toolkit</a>
is one tool supporting this. The <a href=../controller-reference/overview.md>Flux OCM controllers</a>
offer this functionality too.</p><h3 id=example-1>Example<a href=#example-1 class=anchor aria-hidden=true>#</a></h3><p>Let&rsquo;s assume that we have pushed the transport archive to an OCI registry. We need the identity of the
component version and the location of the component-descriptors in the OCI registry:</p><p>ComponentVersion:
name: <code>github.com/jensh007/microblog-deployment</code>
version: <code>0.23.1</code></p><p>URL of OCI registry: <code>ghcr.io/acme.org/microblogapp</code></p><p>It is convenient to put this into an environment variable:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>OCM_REPO=github.com/acme.org/microblog</span></span></span></code></pre></div></figure></div><p>Getting all component-versions of the application with the ocm cli:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>ocm get component ${OCM_REPO}//github.com/jensh007/microblog-deployment:0.23.1 -o yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>element</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>component</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>componentReferences</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.23.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1.5.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>10.11.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>8.5.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>7.0.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/microblog-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ocm.software</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>repositoryContexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sources</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.23.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>meta</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>...</span></span></span></code></pre></div></figure></div><p>With this we can drill down to the installable helm charts and the container images:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocm get resource <span class=si>${</span><span class=nv>OCM_REPO</span><span class=si>}</span>//github.com/jensh007/microblog:0.23.1 -o wide
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME            VERSION IDENTITY TYPE      RELATION ACCESSTYPE  ACCESSSPEC
</span></span><span class=line><span class=cl>microblog-chart 0.23.1           helmChart <span class=nb>local</span>    ociArtifact <span class=o>{</span><span class=s2>&#34;imageReference&#34;</span>:<span class=s2>&#34;ghcr.io/acme.org/microblogapp/github.com/jensh007/microblog/microblog:0.23.1&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>microblog-image 0.23.1           ociImage  <span class=nb>local</span>    ociArtifact <span class=o>{</span><span class=s2>&#34;imageReference&#34;</span>:<span class=s2>&#34;ghcr.io/acme.org/microblogapp/github.com/jensh007/microblog/images/microblog:0.23.1&#34;</span><span class=o>}</span></span></span></code></pre></div></figure></div><p>With this information we can create a helm values file with the updated image reference:</p><p><code>microblog_values_localized.yaml</code>:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>image</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/acme.org/microblogapp/github.com/jensh007/microblog/images/microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.23.1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>imagePullSecrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gcr-secret</span></span></span></code></pre></div></figure></div><p>For a private registry you may also need to specify an image pull secret. This secret has to be present on the target cluster before calling helm commands.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>image</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>imagePullSecrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gcr-secret</span></span></span></code></pre></div></figure></div><p>Note: For a real application deployment there will be more localized settings. Number of replicas, domain names in Ingress specs are typical examples.</p><p>The following steps will act on a target cluster. For this we assume that your <code>KUBECONFIG</code> enviroment variable is set correctly (or append <code>--kubeconfig</code> option).
We will need a namespace in the target cluster. We use the namespace <code>dev</code>for this example:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><pre tabindex=0><code>kubectl create namespace dev</code></pre></figure></div><p>With the localized values we can instruct <code>helm</code> to perform an installation:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>helm install -n dev microblog oci://ghcr.io/acme.org/microblogapp/github.com/jensh007/microblog/microblog --version 0.23.1  --values microblog_values_localized.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Pulled: ghcr.io/acme.org/microblogapp/github.com/jensh007/microblog/microblog:0.23.1
</span></span><span class=line><span class=cl>Digest: sha256:2841665cf3f669ed0a45e70c77bbe27a91ae4dde2d119117ae1e7c1f486ce510
</span></span><span class=line><span class=cl>NAME: microblog
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri Mar <span class=m>10</span> 09:28:04 <span class=m>2023</span>
</span></span><span class=line><span class=cl>NAMESPACE: dev
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>1</span>
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>1. Get the application URL by running these commands:
</span></span><span class=line><span class=cl>  https://microblog.ocm2.hubforplay.shoot.canary.k8s-hana.ondemand.com/</span></span></code></pre></div></figure></div><p>This command instructs helm to create a helm release named <code>microblog</code> and use the
helm chart from our OCI-registry. The location was grabbed from the command above.</p><p>If the command succeeds you can retrieve the status with:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>helm list
</span></span><span class=line><span class=cl>NAME     	NAMESPACE	REVISION	UPDATED                             	STATUS  	CHART              	APP VERSION
</span></span><span class=line><span class=cl>microblog	dev      	<span class=m>1</span>       	2023-03-10 09:28:04.658464 +0100 CET	deployed	microblog-0.23.1   	0.23.1</span></span></code></pre></div></figure></div><p>You can also check the created pod:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get pods
</span></span><span class=line><span class=cl>NAME                                              READY   STATUS             RESTARTS      AGE
</span></span><span class=line><span class=cl>microblog-7c65dc4d9d-tvr97                        0/2     CrashLoopBackOff   <span class=m>10</span> <span class=o>(</span>5s ago<span class=o>)</span>   6m5s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>k describe pod microblog-7c65dc4d9d-tvr97
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Containers:
</span></span><span class=line><span class=cl>  microblog:
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    Image:         ghcr.io/acme.org/microblogapp/github.com/jensh007/microblog/images/microblog:0.23.1
</span></span><span class=line><span class=cl>...</span></span></code></pre></div></figure></div><p>The pod is not in the status running yet because it is missing the required dependencies. We need to perform the additional steps to install them. The steps are the same so we do not repeat them in detail again:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocm get resource <span class=si>${</span><span class=nv>OCM_REPO</span><span class=si>}</span>//github.com/jensh007/nginx-controller:1.5.1 -o wide
</span></span><span class=line><span class=cl>ocm get resource <span class=si>${</span><span class=nv>OCM_REPO</span><span class=si>}</span>//github.com/jensh007/mariadb:10.11.2 -o wide
</span></span><span class=line><span class=cl>ocm get resource <span class=si>${</span><span class=nv>OCM_REPO</span><span class=si>}</span>//github.com/jensh007/elasticsearch:8.5.1 -o wide
</span></span><span class=line><span class=cl>ocm get resource <span class=si>${</span><span class=nv>OCM_REPO</span><span class=si>}</span>//github.com/jensh007/redis:7.09 -o wide</span></span></code></pre></div></figure></div><p>Create files:</p><ul><li>nginx_values_localized.yaml</li><li>mariadb_values_localized.yaml</li><li>elasticsearch_values_localized.yaml</li><li>redis_values_localized.yaml</li></ul><p>and install with:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><pre tabindex=0><code>helm install -n dev nginx oci://ghcr.io/acme.org/microblogapp/github.com/jensh007/nginx-controller/ingress-nginx --version 4.4.2 --values nginx_values_localized.yaml
helm install -n dev mariadb oci://ghcr.io/acme.org/microblogapp/github.com/jensh007/mariadb/mariadb --version 11.4.2 --values mariadb_values_localized.yaml
helm install -n dev elasticsearch oci://ghcr.io/acme.org/microblogapp/github.com/jensh007/elasticsearch/elasticsearch --version 8.5.1 --values elasticsearch_values_localized.yaml
helm install -n dev redis oci://ghcr.io/acme.org/microblogapp/github.com/jensh007/redis/redis --version 17.6.0 --values redis_values_localized.yaml</code></pre></figure></div><h2 id=updating-components>Updating Components<a href=#updating-components class=anchor aria-hidden=true>#</a></h2><p>Updating components requires two steps:</p><ul><li>Updating the component version of the used sub-component</li><li>Updating the root component version to change the reference to the sub-component.</li></ul><p>Given the example from above let us assume we will update mariadb from 10.11.2 to 10.11.3 and the microblog application component from 0.23.1 to 0.24.0.</p><p>We would create a new root component version:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>component</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>componentReferences</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.24.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1.5.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>10.11.3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>8.5.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>componentName</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>7.0.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007/microblog-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ocm.software</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>repositoryContexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sources</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.24.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>meta</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>...</span></span></span></code></pre></div></figure></div><p>For each of the two updated sub-components mariadb and microblog we would also create a new component version.</p><p>You should never change versions of sub-components without increasing the version of the root component. Otherwise you will lose the history of your bill-of-delivery.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/docs/tutorials/input-and-access-types/ class="stretched-link text-reset text-decoration-none">Input and Access Types</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/docs/examples/secure-software-delivery-with-flux-and-open-component-model/ class="stretched-link text-reset text-decoration-none">Secure software delivery with Flux and Open Component Model</a></div><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/privacy/>Privacy Policy</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item><small>© Copyright 2024, <a href=https://www.sap.com/corporate/en/legal/copyright.html>SAP SE </a>and Open Component Model Contributors | <a href=https://www.sap.com/about/legal/trademark.html>Trademark </a>| <a href=/privacy-policy/>Privacy Policy</a> | <a href=https://www.sap.com/corporate/en/legal/terms-of-use.html>Terms of Use</a> | <a href=https://www.sap.com/corporate/en/legal/impressum.html>Legal Disclosure</a></small></li></ul></div></div></div></footer><script async src=/js/app.47b84f3b640408af6efe7bf4add1a36f5b9c6227fbae7b8bcdf0c9ce42fefc54.js integrity="sha256-R7hPO2QECK9u/nv0rdGjb1ucYif7rnuLzfDJzkL+/FQ="></script><script type=text/javascript async src=https://play.vidyard.com/embed/v4.js></script><script async src=/js/flexsearch.b6f80717bc68cd38b6ded7a061f96a73896db6be17a6582f09a63a6040040919.js integrity="sha256-tvgHF7xozTi23tegYflqc4lttr4XplgvCaY6YEAECRk="></script><script async src=/js/search-modal.4e30271fef6fac86c3b4143167e9784bd3f7037ce1045d03a321e7e799e91476.js integrity="sha256-TjAnH+9vrIbDtBQxZ+l4S9P3A3zhBF0DoyHn55npFHY="></script></body></html>