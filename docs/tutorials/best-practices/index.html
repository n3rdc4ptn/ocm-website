<!doctype html><html lang=en data-bs-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href="/main.a201de6fabea905231553f86f88bc30f2be96aa05b8919e68100a42e9fa8945a6085a62aaaabea1dab7874f450568dfa1718ae45db7846fc64fa13882f7a252d.css" integrity="sha512-ogHeb6vqkFIxVT+G+IvDDyvpaqBbiRnmgQCkLp+olFpghaYqqqvqHat4dPRQVo36FxiuRdt4Rvxk+hOIL3olLQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://ocm.software/docs/tutorials/best-practices/><link rel=canonical href=https://ocm.software/docs/tutorials/best-practices/><title>Best Practices | Open Component Model</title>
<meta name=description content><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:title" content="Best Practices"><meta property="og:description" content="This chapter contains guidelines for common scenarios how to work with the Open Component Model, focusing on using CI/CD, build and publishing processes."><meta property="og:type" content="article"><meta property="og:url" content="https://ocm.software/docs/tutorials/best-practices/"><meta property="og:image" content="https://ocm.software/logo-image.png"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-03-13T12:00:26+01:00"><meta property="article:modified_time" content="2023-03-13T12:00:26+01:00"><meta property="og:site_name" content="Open Component Model"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ocm.software/logo-image.png"><meta name=twitter:title content="Best Practices"><meta name=twitter:description content="This chapter contains guidelines for common scenarios how to work with the Open Component Model, focusing on using CI/CD, build and publishing processes."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://ocm.software/","name":"Open Component Model","position":1},{"@type":"ListItem","item":"https://ocm.software/docs/","name":"Docs","position":2},{"@type":"ListItem","item":"https://ocm.software/docs/tutorials/","name":"Tutorials","position":3},{"@type":"ListItem","name":"Best Practices","position":4}]}</script></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand order-0" href=/ aria-label="Open Component Model"><img src=/images/logo-horizontal-white-text.png alt="Open Component Model Logo" class=header-logo>
</a><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details><summary>Overview</summary><ul class="list-unstyled list-nested"><li><a href=/docs/overview/about/>About the OCM Project</a></li><li><a href=/docs/overview/benefits-of-ocm/>Benefits of OCM</a></li><li><a href=/docs/overview/important-terms/>Important Terms</a></li><li><a href=/docs/overview/specification/>Specification</a></li></ul></details></li><li><details><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/installing-the-ocm-cli/>Installing the OCM CLI</a></li><li><details open><summary>First Steps with OCM</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/getting-started-with-ocm/prerequisites/>Prerequisites</a></li><li><a href=/docs/getting-started/getting-started-with-ocm/create-a-component-version/>Create a Component Version</a></li><li><a href=/docs/getting-started/getting-started-with-ocm/display-and-examine-component-versions/>Display and Examine Component Versions</a></li><li><a href=/docs/getting-started/getting-started-with-ocm/transport-ocm-component-versions/>Transport OCM Component Versions</a></li><li><a href=/docs/getting-started/getting-started-with-ocm/sign-component-versions/>Sign Component Versions</a></li></ul></details></li></ul></details></li><li><details><summary>OCM Controllers</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/architecture/>Architecture</a></li><li><a href=/docs/controller/installation/>Installation</a></li><li><details><summary>Kubernetes Controllers</summary><ul class="list-unstyled list-nested"><li><details><summary>API Reference</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/api-reference/ocm-controller-api-v1/>OCM Controller API v1</a></li><li><a href=/docs/controller/controller-reference/api-reference/replication-controller-api-v1/>Replication Controller API v1</a></li></ul></details></li><li><details><summary>OCM Controller</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/ocm-controller/component-version/>Component Version</a></li></ul></details></li><li><details><summary>Replication Controller</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/replication-controller/component-subscription/>Component Subscription</a></li></ul></details></li></ul></details></li></ul></details></li><li><details open><summary>Component Descriptors</summary><ul class="list-unstyled list-nested"><li><a href=/docs/component-descriptors/version-2/>Version 2</a></li><li><a href=/docs/component-descriptors/version-3/>Version 3</a></li></ul></details></li><li><details open><summary>Tutorials</summary><ul class="list-unstyled list-nested"><li><details><summary>OCM and GitOps</summary><ul class="list-unstyled list-nested"><li><a href=/docs/tutorials/ocm-and-gitops/air-gapped-gitops-with-ocm-flux/>Air-gapped GitOps with OCM & Flux</a></li><li><a href=/docs/tutorials/ocm-and-gitops/deploying-applications-with-ocm-gitops/>Deploying Applications with OCM & GitOps</a></li><li><a href=/docs/tutorials/ocm-and-gitops/gitops-driven-configuration-of-ocm-applications/>GitOps Driven Configuration of OCM Applications</a></li></ul></details></li><li class=active><a aria-current=page href=/docs/tutorials/best-practices/>Best Practices</a></li><li><a href=/docs/tutorials/build-deploy-infrastructure-via-helm-charts-with-ocm/>Build & Deploy Infrastructure via Helm Charts with OCM</a></li><li><a href=/docs/tutorials/structuring-and-deploying-software-products-with-ocm/>Structuring and Deploying Software Products with OCM</a></li><li><a href=/docs/tutorials/input-and-access-types/>Input and Access Types</a></li><li><a href=/docs/tutorials/></a></li></ul></details></li><li><details><summary>Examples</summary><ul class="list-unstyled list-nested"><li><a href=/docs/examples/secure-software-delivery-with-flux-and-open-component-model/>Secure software delivery with Flux and Open Component Model</a></li></ul></details></li><li><details><summary>Roadmap</summary><ul class="list-unstyled list-nested"><li><a href=/docs/roadmap/our-roadmap/>Our Roadmap</a></li></ul></details></li><li><details><summary>Support</summary><ul class="list-unstyled list-nested"><li><a href=/docs/support/how-to-get-support/>How to get Support</a></li><li><a href=/docs/support/freqently-asked-questions/>Freqently Asked Questions</a></li><li><a href=/docs/support/community/>The OCM Community</a></li></ul></details></li><li><details><summary>Contribute</summary><ul class="list-unstyled list-nested"><li><a href=/docs/contribution/contributing-guideline/>Contributing Guideline</a></li><li><a href=/docs/contribution/security-guideline/>Security Guideline</a></li></ul></details></li><li><details><summary>cli-reference</summary><ul class="list-unstyled list-nested"><li><details><summary>add</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/add/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/add/references/>references</a></li><li><a href=/docs/cli-reference/add/resource-configuration/>resource-configuration</a></li><li><a href=/docs/cli-reference/add/resources/>resources</a></li><li><a href=/docs/cli-reference/add/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/add/source-configuration/>source-configuration</a></li><li><a href=/docs/cli-reference/add/sources/>sources</a></li></ul></details></li><li><details><summary>check</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/check/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>clean</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/clean/cache/>cache</a></li></ul></details></li><li><details><summary>create</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/create/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/create/rsakeypair/>rsakeypair</a></li><li><a href=/docs/cli-reference/create/transportarchive/>transportarchive</a></li></ul></details></li><li><details><summary>describe</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/describe/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/describe/cache/>cache</a></li><li><a href=/docs/cli-reference/describe/package/>package</a></li><li><a href=/docs/cli-reference/describe/plugins/>plugins</a></li></ul></details></li><li><details><summary>download</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/download/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/download/cli/>cli</a></li><li><a href=/docs/cli-reference/download/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/download/resources/>resources</a></li></ul></details></li><li><details><summary>get</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/get/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/get/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/get/credentials/>credentials</a></li><li><a href=/docs/cli-reference/get/plugins/>plugins</a></li><li><a href=/docs/cli-reference/get/references/>references</a></li><li><a href=/docs/cli-reference/get/resources/>resources</a></li><li><a href=/docs/cli-reference/get/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/get/sources/>sources</a></li></ul></details></li><li><details><summary>help</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/help/attributes/>attributes</a></li><li><a href=/docs/cli-reference/help/configfile/>configfile</a></li><li><a href=/docs/cli-reference/help/credential-handling/>credential-handling</a></li><li><a href=/docs/cli-reference/help/logging/>logging</a></li><li><a href=/docs/cli-reference/help/oci-references/>oci-references</a></li><li><a href=/docs/cli-reference/help/ocm-accessmethods/>ocm-accessmethods</a></li><li><a href=/docs/cli-reference/help/ocm-downloadhandlers/>ocm-downloadhandlers</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-references/>ocm-references</a></li><li><a href=/docs/cli-reference/help/ocm-uploadhandlers/>ocm-uploadhandlers</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li></ul></details></li><li><details><summary>list</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/list/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>show</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/show/tags/>tags</a></li><li><a href=/docs/cli-reference/show/versions/>versions</a></li></ul></details></li><li><details><summary>sign</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/sign/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/sign/hash/>hash</a></li></ul></details></li><li><details><summary>transfer</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/transfer/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/transfer/commontransportarchive/>commontransportarchive</a></li><li><a href=/docs/cli-reference/transfer/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/transfer/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>verify</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/verify/componentversions/>componentversions</a></li></ul></details></li></ul></details></li></ul></nav></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>Open Component Model</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://ocm.software/docs/overview/about>Project</a></li><li class=nav-item><a class=nav-link href=https://ocm.software/docs/overview/specification>Spec</a></li><li class=nav-item><a class=nav-link href=https://ocm.software/docs/support/community>Community</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/open-component-model><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://kubernetes.slack.com/archives/C05UWBE8R1D><svg role="img" width="22" height="22" viewBox="0 0 24 24" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M5.042 15.165a2.528 2.528.0 01-2.52 2.523A2.528 2.528.0 010 15.165a2.527 2.527.0 012.522-2.52h2.52v2.52zm1.271.0a2.527 2.527.0 012.521-2.52 2.527 2.527.0 012.521 2.52v6.313A2.528 2.528.0 018.834 24a2.528 2.528.0 01-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528.0 01-2.521-2.52A2.528 2.528.0 018.834.0a2.528 2.528.0 012.521 2.522v2.52H8.834zm0 1.271a2.528 2.528.0 012.521 2.521 2.528 2.528.0 01-2.521 2.521H2.522A2.528 2.528.0 010 8.834a2.528 2.528.0 012.522-2.521h6.312zM18.956 8.834a2.528 2.528.0 012.522-2.521A2.528 2.528.0 0124 8.834a2.528 2.528.0 01-2.522 2.521h-2.522V8.834zm-1.268.0a2.528 2.528.0 01-2.523 2.521 2.527 2.527.0 01-2.52-2.521V2.522A2.527 2.527.0 0115.165.0a2.528 2.528.0 012.523 2.522v6.312zM15.165 18.956a2.528 2.528.0 012.523 2.522A2.528 2.528.0 0115.165 24a2.527 2.527.0 01-2.52-2.522v-2.522h2.52zm0-1.268a2.527 2.527.0 01-2.52-2.523 2.526 2.526.0 012.52-2.52h6.313A2.527 2.527.0 0124 15.165a2.528 2.528.0 01-2.522 2.523h-6.313z"/></svg><small class="ms-2 visually-hidden">Slack</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-offset d-none d-lg-block"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details><summary>Overview</summary><ul class="list-unstyled list-nested"><li><a href=/docs/overview/about/>About the OCM Project</a></li><li><a href=/docs/overview/benefits-of-ocm/>Benefits of OCM</a></li><li><a href=/docs/overview/important-terms/>Important Terms</a></li><li><a href=/docs/overview/specification/>Specification</a></li></ul></details></li><li><details><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/installing-the-ocm-cli/>Installing the OCM CLI</a></li><li><details open><summary>First Steps with OCM</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/getting-started-with-ocm/prerequisites/>Prerequisites</a></li><li><a href=/docs/getting-started/getting-started-with-ocm/create-a-component-version/>Create a Component Version</a></li><li><a href=/docs/getting-started/getting-started-with-ocm/display-and-examine-component-versions/>Display and Examine Component Versions</a></li><li><a href=/docs/getting-started/getting-started-with-ocm/transport-ocm-component-versions/>Transport OCM Component Versions</a></li><li><a href=/docs/getting-started/getting-started-with-ocm/sign-component-versions/>Sign Component Versions</a></li></ul></details></li></ul></details></li><li><details><summary>OCM Controllers</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/architecture/>Architecture</a></li><li><a href=/docs/controller/installation/>Installation</a></li><li><details><summary>Kubernetes Controllers</summary><ul class="list-unstyled list-nested"><li><details><summary>API Reference</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/api-reference/ocm-controller-api-v1/>OCM Controller API v1</a></li><li><a href=/docs/controller/controller-reference/api-reference/replication-controller-api-v1/>Replication Controller API v1</a></li></ul></details></li><li><details><summary>OCM Controller</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/ocm-controller/component-version/>Component Version</a></li></ul></details></li><li><details><summary>Replication Controller</summary><ul class="list-unstyled list-nested"><li><a href=/docs/controller/controller-reference/replication-controller/component-subscription/>Component Subscription</a></li></ul></details></li></ul></details></li></ul></details></li><li><details open><summary>Component Descriptors</summary><ul class="list-unstyled list-nested"><li><a href=/docs/component-descriptors/version-2/>Version 2</a></li><li><a href=/docs/component-descriptors/version-3/>Version 3</a></li></ul></details></li><li><details open><summary>Tutorials</summary><ul class="list-unstyled list-nested"><li><details><summary>OCM and GitOps</summary><ul class="list-unstyled list-nested"><li><a href=/docs/tutorials/ocm-and-gitops/air-gapped-gitops-with-ocm-flux/>Air-gapped GitOps with OCM & Flux</a></li><li><a href=/docs/tutorials/ocm-and-gitops/deploying-applications-with-ocm-gitops/>Deploying Applications with OCM & GitOps</a></li><li><a href=/docs/tutorials/ocm-and-gitops/gitops-driven-configuration-of-ocm-applications/>GitOps Driven Configuration of OCM Applications</a></li></ul></details></li><li class=active><a aria-current=page href=/docs/tutorials/best-practices/>Best Practices</a></li><li><a href=/docs/tutorials/build-deploy-infrastructure-via-helm-charts-with-ocm/>Build & Deploy Infrastructure via Helm Charts with OCM</a></li><li><a href=/docs/tutorials/structuring-and-deploying-software-products-with-ocm/>Structuring and Deploying Software Products with OCM</a></li><li><a href=/docs/tutorials/input-and-access-types/>Input and Access Types</a></li><li><a href=/docs/tutorials/></a></li></ul></details></li><li><details><summary>Examples</summary><ul class="list-unstyled list-nested"><li><a href=/docs/examples/secure-software-delivery-with-flux-and-open-component-model/>Secure software delivery with Flux and Open Component Model</a></li></ul></details></li><li><details><summary>Roadmap</summary><ul class="list-unstyled list-nested"><li><a href=/docs/roadmap/our-roadmap/>Our Roadmap</a></li></ul></details></li><li><details><summary>Support</summary><ul class="list-unstyled list-nested"><li><a href=/docs/support/how-to-get-support/>How to get Support</a></li><li><a href=/docs/support/freqently-asked-questions/>Freqently Asked Questions</a></li><li><a href=/docs/support/community/>The OCM Community</a></li></ul></details></li><li><details><summary>Contribute</summary><ul class="list-unstyled list-nested"><li><a href=/docs/contribution/contributing-guideline/>Contributing Guideline</a></li><li><a href=/docs/contribution/security-guideline/>Security Guideline</a></li></ul></details></li><li><details><summary>cli-reference</summary><ul class="list-unstyled list-nested"><li><details><summary>add</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/add/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/add/references/>references</a></li><li><a href=/docs/cli-reference/add/resource-configuration/>resource-configuration</a></li><li><a href=/docs/cli-reference/add/resources/>resources</a></li><li><a href=/docs/cli-reference/add/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/add/source-configuration/>source-configuration</a></li><li><a href=/docs/cli-reference/add/sources/>sources</a></li></ul></details></li><li><details><summary>check</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/check/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>clean</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/clean/cache/>cache</a></li></ul></details></li><li><details><summary>create</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/create/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/create/rsakeypair/>rsakeypair</a></li><li><a href=/docs/cli-reference/create/transportarchive/>transportarchive</a></li></ul></details></li><li><details><summary>describe</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/describe/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/describe/cache/>cache</a></li><li><a href=/docs/cli-reference/describe/package/>package</a></li><li><a href=/docs/cli-reference/describe/plugins/>plugins</a></li></ul></details></li><li><details><summary>download</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/download/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/download/cli/>cli</a></li><li><a href=/docs/cli-reference/download/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/download/resources/>resources</a></li></ul></details></li><li><details><summary>get</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/get/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/get/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/get/credentials/>credentials</a></li><li><a href=/docs/cli-reference/get/plugins/>plugins</a></li><li><a href=/docs/cli-reference/get/references/>references</a></li><li><a href=/docs/cli-reference/get/resources/>resources</a></li><li><a href=/docs/cli-reference/get/routingslips/>routingslips</a></li><li><a href=/docs/cli-reference/get/sources/>sources</a></li></ul></details></li><li><details><summary>help</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/help/attributes/>attributes</a></li><li><a href=/docs/cli-reference/help/configfile/>configfile</a></li><li><a href=/docs/cli-reference/help/credential-handling/>credential-handling</a></li><li><a href=/docs/cli-reference/help/logging/>logging</a></li><li><a href=/docs/cli-reference/help/oci-references/>oci-references</a></li><li><a href=/docs/cli-reference/help/ocm-accessmethods/>ocm-accessmethods</a></li><li><a href=/docs/cli-reference/help/ocm-downloadhandlers/>ocm-downloadhandlers</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-labels/>ocm-labels</a></li><li><a href=/docs/cli-reference/help/ocm-references/>ocm-references</a></li><li><a href=/docs/cli-reference/help/ocm-uploadhandlers/>ocm-uploadhandlers</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li><li><a href=/docs/cli-reference/help/toi-bootstrapping/>toi-bootstrapping</a></li></ul></details></li><li><details><summary>list</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/list/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>show</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/show/tags/>tags</a></li><li><a href=/docs/cli-reference/show/versions/>versions</a></li></ul></details></li><li><details><summary>sign</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/sign/componentversions/>componentversions</a></li><li><a href=/docs/cli-reference/sign/hash/>hash</a></li></ul></details></li><li><details><summary>transfer</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/transfer/artifacts/>artifacts</a></li><li><a href=/docs/cli-reference/transfer/commontransportarchive/>commontransportarchive</a></li><li><a href=/docs/cli-reference/transfer/componentarchive/>componentarchive</a></li><li><a href=/docs/cli-reference/transfer/componentversions/>componentversions</a></li></ul></details></li><li><details><summary>verify</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cli-reference/verify/componentversions/>componentversions</a></li></ul></details></li></ul></details></li></ul></nav></div><div class="col container-fw d-lg-flex flex-lg-row justify-content-center mx-auto"><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#separate-build-and-publish-processes>Separate Build and Publish Processes</a></li><li><a href=#separation-between-build-and-publish>Separation Between Build and Publish</a></li><li><a href=#building-multi-architecture-images>Building Multi-Architecture Images</a></li><li><a href=#using-makefiles>Using Makefiles</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#templating-the-resources>Templating the Resources</a></li></ul></li><li><a href=#pipeline-integration>Pipeline Integration</a></li><li><a href=#static-and-dynamic-variable-substitution>Static and Dynamic Variable Substitution</a></li><li><a href=#debugging-explain-the-blobs-directory>Debugging: Explain the Blobs Directory</a></li><li><a href=#self-contained-transport-archives>Self-Contained Transport Archives</a></li><li><a href=#cicd-integration>CICD Integration</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Best Practices</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#separate-build-and-publish-processes>Separate Build and Publish Processes</a></li><li><a href=#separation-between-build-and-publish>Separation Between Build and Publish</a></li><li><a href=#building-multi-architecture-images>Building Multi-Architecture Images</a></li><li><a href=#using-makefiles>Using Makefiles</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#templating-the-resources>Templating the Resources</a></li></ul></li><li><a href=#pipeline-integration>Pipeline Integration</a></li><li><a href=#static-and-dynamic-variable-substitution>Static and Dynamic Variable Substitution</a></li><li><a href=#debugging-explain-the-blobs-directory>Debugging: Explain the Blobs Directory</a></li><li><a href=#self-contained-transport-archives>Self-Contained Transport Archives</a></li><li><a href=#cicd-integration>CICD Integration</a></li></ul></nav></div></details></nav><p>This chapter contains guidelines for common scenarios how to work with the Open Component Model, focusing on using CI/CD, build and publishing processes.</p><ul><li><a href=#separate-build-and-publish-processes>Separate Build and Publish Processes</a></li><li><a href=#separation-between-build-and-publish>Separation Between Build and Publish</a></li><li><a href=#building-multi-architecture-images>Building Multi-Architecture Images</a></li><li><a href=#using-makefiles>Using Makefiles</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#templating-the-resources>Templating the Resources</a></li></ul></li><li><a href=#pipeline-integration>Pipeline Integration</a></li><li><a href=#static-and-dynamic-variable-substitution>Static and Dynamic Variable Substitution</a></li><li><a href=#debugging-explain-the-blobs-directory>Debugging: Explain the Blobs Directory</a></li><li><a href=#self-contained-transport-archives>Self-Contained Transport Archives</a></li><li><a href=#cicd-integration>CICD Integration</a></li></ul><h2 id=separate-build-and-publish-processes>Separate Build and Publish Processes<a href=#separate-build-and-publish-processes class=anchor aria-hidden=true>#</a></h2><p>Traditional automated builds often have unrestricted internet access, which can lead to several challenges in enterprise environments:</p><ul><li>Limited control over downloaded artifacts</li><li>Potential unavailability of required resources</li><li>Security risks associated with write permissions to external repositories</li></ul><p>Best practice: Implement a two-step process:
a) Build: Create artifacts in a controlled environment, using local mirrors when possible.
b) Publish: Use a separate, secured process to distribute build results.</p><p>OCM supports this approach through filesystem-based OCM repositories, allowing you to generate Common Transport Format (CTF) archives for component versions. These archives can then be securely processed and distributed.</p><h2 id=separation-between-build-and-publish>Separation Between Build and Publish<a href=#separation-between-build-and-publish class=anchor aria-hidden=true>#</a></h2><p>Typical automated builds have access to the complete internet ecosystem. This involves
downloading of content required for a build (e.g., <code>go mod tidy</code>), but also the upload
of build results to repositories (e.g., OCI image registries).</p><p>For builds in enterprise environments this can lead to several challenges:</p><ul><li>Limited control over downloaded artifacts</li><li>Potential unavailability of required resources</li><li>Security risks associated with write permissions to external repositories</li></ul><p>The first problem might be acceptable, because the build results may be analyzed by scanners
later to figure out what has been packaged. Triaging the results could be done in an asynchronous
step later.</p><p>The second problem could be solved by mirroring the required artifacts and instrument the build to use the artifacts from the local mirror. Such a mirror would also offer a solution for the first problem and act as target for various scanning tools.</p><p>The third problem might pose severe security risks, because the build procedure
as well as the downloaded artifacts may be used to catch registry credentials or at least
corrupt the content of those repositories.</p><p>This could be avoided by establishing a contract between the build procedure of a
component/project and the build system, providing the build result as a local file
or file-structure. This is then taken by the build system to push content wherever
it should be pushed to. This way the execution of the build procedure does not need
write permissions to any repository, because it never pushes build results.</p><p>The Open Component Model supports such processes by supporting filesystem based
OCM repositories, which are able to host any type of content, regardless of its
technology. The task of the build then is to provide such a <em>CTF</em> archive for the
OCM component versions generated by the build. This archive can then be
used by the build-system to do whatever is required to make the content accessible
by others.</p><p>The composition of such archives is described in the <a href=https://github.com/open-component-model/ocm-website/blob/main/content/docs/getting-started/getting-started-with-ocm/prerequisites.md>Getting Started Section</a>.</p><p>To secure further processes, a <em>certified build-system</em> could even sign the content with
its build system certificate to enable followup-processes to verify that involved component
versions are provided by accepted and well-known processes.</p><h2 id=building-multi-architecture-images>Building Multi-Architecture Images<a href=#building-multi-architecture-images class=anchor aria-hidden=true>#</a></h2><blockquote><p><strong>Note:</strong> This section provides information only on on building multi-arch images. Referencing a multi-arch image does not differ from images for just one platform, see the <a href=https://github.com/open-component-model/ocm/blob/main/docs/reference/ocm_add_resources.md><code>ocm add resources</code></a> command for the OCM CLI</p></blockquote><p>At the time of writing this guide Docker is not able to build multi-architecture (multi-arch / multi-platform)
images natively. Instead, the <code>buildx</code> plugin is used. However, this implies building and pushing
images in one step to a remote container registry as the local Docker image store does not
support multi-arch images (for additional information, see the <a href=https://www.docker.com/blog/multi-arch-build-and-images-the-simple-way>Multi-arch build and images, the simple way</a> blogpost)</p><p>The OCM CLI has some built-in support for dealing with multi-arch images during the
component version composition (<a href=https://github.com/open-component-model/ocm/blob/main/docs/reference/ocm_add_resources.md><code>ocm add resources</code></a>).
This allows building all artifacts locally and push them in a separate step to a container registry. This
is done by building single-arch images in a first step (still using <code>buildx</code> for cross-platform
building). In a second step all images are bundled into a multi-arch image, which is stored as
local artifact in a component (CA) or common transport (CTF)
archive. This archive can be processed as usual (e.g., for signing or transfer to other locations).
When pushed to an image registry, multi-arch images are generated with a multi-arch-image manifest.</p><p>The following steps illustrate this procedure. For a simple project with a Go binary and a
helm-chart assume the following file structure:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl> tree .
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── Dockerfile
</span></span><span class=line><span class=cl>├── go.mod
</span></span><span class=line><span class=cl>├── helmchart
</span></span><span class=line><span class=cl>│   ├── Chart.yaml
</span></span><span class=line><span class=cl>│   ├── templates
</span></span><span class=line><span class=cl>│   │   ├── ...
</span></span><span class=line><span class=cl>│   └── values.yaml
</span></span><span class=line><span class=cl>└── main.go</span></span></code></pre></div></figure></div><p>The Dockerfile has the following content:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> golang:1.19 AS builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> go.mod ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> main.go ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># RUN go mod download</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> go build -o /helloserver main.go<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Create a new release build stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> gcr.io/distroless/base-debian10</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Set the working directory to the root directory path</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy over the binary built from the previous stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /helloserver /helloserver<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;/helloserver&#34;</span><span class=p>]</span></span></span></code></pre></div></figure></div><p>Now we want to build images for two platforms using Docker and buildx. Note the <code>--load</code> option for
<code>buildx</code> to store the image in the local Docker store. Note the architecture suffix in the tag to be
able to distinguish the images for the different platforms. Also note that the tag has a different
syntax than the <code>--platform</code> argument for <code>buildx</code> as slashes are not allowed in tags.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nv>TAG_PREFIX</span><span class=o>=</span>eu.gcr.io/my-project/acme <span class=c1># path to you OCI registry</span>
</span></span><span class=line><span class=cl>$ <span class=nv>PLATFORM</span><span class=o>=</span>linux/amd64
</span></span><span class=line><span class=cl>$ <span class=nv>VERSION</span><span class=o>=</span>0.1.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker buildx build --load -t <span class=si>${</span><span class=nv>TAG_PREFIX</span><span class=si>}</span>/simpleserver:0.1.0-linux-amd64 --platform linux/amd64 .
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Building 54.4s <span class=o>(</span>14/14<span class=o>)</span> <span class=nv>FINISHED</span>
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load build definition from dockerfile                                                                          0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring dockerfile: 660B                                                                                          0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load .dockerignore                                                                                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring context: 2B                                                                                               0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load metadata <span class=k>for</span> gcr.io/distroless/base-debian10:latest                                                       1.6s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load metadata <span class=k>for</span> docker.io/library/golang:1.19                                                                1.2s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 1/5<span class=o>]</span> FROM docker.io/library/golang:1.19@sha256:dc76ef03e54c34a00dcdca81e55c242d24b34d231637776c4bb5c1a8e851425  49.2s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; resolve docker.io/library/golang:1.19@sha256:dc76ef03e54c34a00dcdca81e55c242d24b34d231637776c4bb5c1a8e8514253          0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:14a70245b07c7f5056bdd90a3d93e37417ec26542def5a37ac8f19e437562533 156B / 156B                                    0.2s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:a2b47720d601b6c6c6e7763b4851e25475118d80a76be466ef3aa388abf2defd 148.91MB / 148.91MB                           46.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:52908dc1c386fab0271a2b84b6ef4d96205a98a8c8801169554767172e45d8c7 85.97MB / 85.97MB                             42.9s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:195ea6a58ca87a18477965a6e6a8623112bde82c5b568a29c56ce4581b6e6695 54.59MB / 54.59MB                             33.8s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:c85a0be79bfba309d1f05dc40b447aa82b604593531fed1e7e12e4bef63483a5 10.88MB / 10.88MB                              3.4s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:e4e46864aba2e62ba7c75965e4aa33ec856ee1b1074dda6b478101c577b63abd 5.16MB / 5.16MB                                1.5s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:a8ca11554fce00d9177da2d76307bdc06df7faeb84529755c648ac4886192ed1 55.04MB / 55.04MB                             19.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:a8ca11554fce00d9177da2d76307bdc06df7faeb84529755c648ac4886192ed1                                     1.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:e4e46864aba2e62ba7c75965e4aa33ec856ee1b1074dda6b478101c577b63abd                                     0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:c85a0be79bfba309d1f05dc40b447aa82b604593531fed1e7e12e4bef63483a5                                     0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:195ea6a58ca87a18477965a6e6a8623112bde82c5b568a29c56ce4581b6e6695                                     1.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:52908dc1c386fab0271a2b84b6ef4d96205a98a8c8801169554767172e45d8c7                                     1.5s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:a2b47720d601b6c6c6e7763b4851e25475118d80a76be466ef3aa388abf2defd                                     2.8s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:14a70245b07c7f5056bdd90a3d93e37417ec26542def5a37ac8f19e437562533                                     0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>stage-1 1/3<span class=o>]</span> FROM gcr.io/distroless/base-debian10@sha256:101798a3b76599762d3528635113f0466dc9655ecba82e8e33d410e2bf5cd  30.7s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; resolve gcr.io/distroless/base-debian10@sha256:101798a3b76599762d3528635113f0466dc9655ecba82e8e33d410e2bf5cd319        0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:f291067d32d8d06c3b996ba726b9aa93a71f6f573098880e05d16660cfc44491 8.12MB / 8.12MB                               30.6s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:2445dbf7678f5ec17f5654ac2b7ad14d7b1ea3af638423fc68f5b38721f25fa4 657.02kB / 657.02kB                            1.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:2445dbf7678f5ec17f5654ac2b7ad14d7b1ea3af638423fc68f5b38721f25fa4                                     0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:f291067d32d8d06c3b996ba726b9aa93a71f6f573098880e05d16660cfc44491                                     0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load build context                                                                                             0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring context: 575B                                                                                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 2/5<span class=o>]</span> WORKDIR /app                                                                                                0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 3/5<span class=o>]</span> COPY go.mod ./                                                                                              0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 4/5<span class=o>]</span> COPY main.go ./                                                                                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 5/5<span class=o>]</span> RUN go build -o /helloserver main.go                                                                        2.4s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>stage-1 2/3<span class=o>]</span> COPY --from<span class=o>=</span>builder /helloserver /helloserver                                                               0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; exporting to oci image format                                                                                             0.8s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; exporting layers                                                                                                       0.2s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; exporting manifest sha256:04d69fc3245757d327d96b1a83b7a64543d970953c61d1014ae6980ed8b3ba2a                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; exporting config sha256:08641d64f612661a711587b07cfeeb6d2804b97998cfad85864a392c1aabcd06                               0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sending tarball                                                                                                        0.6s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; importing to docker</span></span></code></pre></div></figure></div><p>Repeat this command for the second platform:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ docker buildx build --load -t <span class=si>${</span><span class=nv>TAG_PREFIX</span><span class=si>}</span>/simpleserver:0.1.0-linux-arm64 --platform linux/arm64 .
</span></span><span class=line><span class=cl>docker buildx build --load -t <span class=si>${</span><span class=nv>TAG_PREFIX</span><span class=si>}</span>/simpleserver:0.1.0-linux-arm64 --platform linux/arm64 .
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Building 40.1s <span class=o>(</span>14/14<span class=o>)</span> <span class=nv>FINISHED</span>
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load .dockerignore                                                                                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring context: 2B                                                                                               0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load build definition from dockerfile                                                                          0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring dockerfile: 660B                                                                                          0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load metadata <span class=k>for</span> gcr.io/distroless/base-debian10:latest                                                       1.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load metadata <span class=k>for</span> docker.io/library/golang:1.19                                                                1.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 1/5<span class=o>]</span> FROM docker.io/library/golang:1.19@sha256:dc76ef03e54c34a00dcdca81e55c242d24b34d231637776c4bb5c1a8e851425  37.7s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; resolve docker.io/library/golang:1.19@sha256:dc76ef03e54c34a00dcdca81e55c242d24b34d231637776c4bb5c1a8e8514253          0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:cd807e8b483974845eabbdbbaa4bb3a66f74facd8c061e01e923e9f1da608271 157B / 157B                                    0.2s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:fecd6ba4b3f93b6c90f4058b512f1b0a44223ccb3244f0049b16fe2c1b41cf45 115.13MB / 115.13MB                           35.6s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:4fb255e3f99867ec7a2286dfbbef990491cde0a5d226d92be30bad4f9e917fa4 81.37MB / 81.37MB                             31.8s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:426e8acfed2a5373bd99b22b5a968d55a148e14bc0e0f51c5cf0d779afefe291 54.68MB / 54.68MB                             26.7s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:3d7b1480fa4dae5cbbb7d091c46ae0ae52f501418d4cfeb849b87023364e2564 10.87MB / 10.87MB                              3.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:a3e29af4daf3531efcc63588162e8bdcf3434aa5d72df4eabeb5e20c6695e303 5.15MB / 5.15MB                                1.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:077c13527d405646e2f6bb426e04716ae4f8dd2fdd8966dcb0194564a2b57896 53.70MB / 53.70MB                             13.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:077c13527d405646e2f6bb426e04716ae4f8dd2fdd8966dcb0194564a2b57896                                     0.9s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:a3e29af4daf3531efcc63588162e8bdcf3434aa5d72df4eabeb5e20c6695e303                                     0.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:3d7b1480fa4dae5cbbb7d091c46ae0ae52f501418d4cfeb849b87023364e2564                                     0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:426e8acfed2a5373bd99b22b5a968d55a148e14bc0e0f51c5cf0d779afefe291                                     1.2s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:4fb255e3f99867ec7a2286dfbbef990491cde0a5d226d92be30bad4f9e917fa4                                     1.4s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:fecd6ba4b3f93b6c90f4058b512f1b0a44223ccb3244f0049b16fe2c1b41cf45                                     2.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:cd807e8b483974845eabbdbbaa4bb3a66f74facd8c061e01e923e9f1da608271                                     0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>stage-1 1/3<span class=o>]</span> FROM gcr.io/distroless/base-debian10@sha256:101798a3b76599762d3528635113f0466dc9655ecba82e8e33d410e2bf5cd  25.7s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; resolve gcr.io/distroless/base-debian10@sha256:101798a3b76599762d3528635113f0466dc9655ecba82e8e33d410e2bf5cd319        0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:21d6a6c3921f47fb0a96eb028b4c3441944a6e5a44b30cd058425ccc66279760 7.13MB / 7.13MB                               25.5s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sha256:7d441aeb75fe3c941ee4477191c6b19edf2ad8310bac7356a799c20df198265c 657.02kB / 657.02kB                            1.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:7d441aeb75fe3c941ee4477191c6b19edf2ad8310bac7356a799c20df198265c                                     0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; extracting sha256:21d6a6c3921f47fb0a96eb028b4c3441944a6e5a44b30cd058425ccc66279760                                     0.1s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>internal<span class=o>]</span> load build context                                                                                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring context: 54B                                                                                              0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 2/5<span class=o>]</span> WORKDIR /app                                                                                                0.2s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 3/5<span class=o>]</span> COPY go.mod ./                                                                                              0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 4/5<span class=o>]</span> COPY main.go ./                                                                                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>builder 5/5<span class=o>]</span> RUN go build -o /helloserver main.go                                                                        0.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>stage-1 2/3<span class=o>]</span> COPY --from<span class=o>=</span>builder /helloserver /helloserver                                                               0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; exporting to oci image format                                                                                             0.5s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; exporting layers                                                                                                       0.2s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; exporting manifest sha256:267ed1266b2b0ed74966e72d4ae8a2dfcf77777425d32a9a46f0938c962d9600                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; exporting config sha256:67102364e254bf5a8e58fa21ea56eb40645851d844f5c4d9651b4af7a40be780                               0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; sending tarball                                                                                                        0.3s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; importing to docker</span></span></code></pre></div></figure></div><p>Check that the images were created correctly:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ docker image ls
</span></span><span class=line><span class=cl>REPOSITORY                                              TAG                 IMAGE ID       CREATED              SIZE
</span></span><span class=line><span class=cl>eu.gcr.io/acme/simpleserver   0.1.0-linux-arm64   67102364e254   <span class=m>6</span> seconds ago        22.4MB
</span></span><span class=line><span class=cl>eu.gcr.io/acme/simpleserver   0.1.0-linux-amd64   08641d64f612   About a minute ago   25.7MB</span></span></code></pre></div></figure></div><p>In the next step we create a component archive and a transport archive</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nv>PROVIDER</span><span class=o>=</span>acme
</span></span><span class=line><span class=cl>$ <span class=nv>COMPONENT</span><span class=o>=</span>github.com/<span class=k>$(</span>PROVIDER<span class=k>)</span>/simpleserver
</span></span><span class=line><span class=cl>$ <span class=nv>VERSION</span><span class=o>=</span>0.1.0
</span></span><span class=line><span class=cl>$ mkdir gen
</span></span><span class=line><span class=cl>$ ocm create ca <span class=si>${</span><span class=nv>COMPONENT</span><span class=si>}</span> <span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span> --provider <span class=si>${</span><span class=nv>PROVIDER</span><span class=si>}</span> --file gen/ca</span></span></code></pre></div></figure></div><p>Create the file <code>resources.yaml</code>. Note the variants in the image input and the type <code>dockermulti</code>:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>chart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helmChart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>helm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>helmchart</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociImage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.1.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>dockermulti</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class=l>eu.gcr.io/acme/simpleserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variants</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=s2>&#34;eu.gcr.io/acme/simpleserver:0.1.0-linux-amd64&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=s2>&#34;eu.gcr.io/acme/simpleserver:0.1.0-linux-arm64&#34;</span></span></span></code></pre></div></figure></div><p>The input type <code>dockermulti</code> adds a multi-arch image composed by the given dedicated images from the local Docker
image store as local artifact to the component archive.</p><p>Add the described resources to your component archive:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ocm add resources ./gen/ca resources.yaml
</span></span><span class=line><span class=cl>processing resources.yaml...
</span></span><span class=line><span class=cl>  processing document 1...
</span></span><span class=line><span class=cl>    processing index <span class=m>1</span>
</span></span><span class=line><span class=cl>  processing document 2...
</span></span><span class=line><span class=cl>    processing index <span class=m>1</span>
</span></span><span class=line><span class=cl>found <span class=m>2</span> resources
</span></span><span class=line><span class=cl>adding resource helmChart: <span class=s2>&#34;name&#34;</span><span class=o>=</span><span class=s2>&#34;chart&#34;</span>,<span class=s2>&#34;version&#34;</span><span class=o>=</span><span class=s2>&#34;&lt;componentversion&gt;&#34;</span>...
</span></span><span class=line><span class=cl>adding resource ociImage: <span class=s2>&#34;name&#34;</span><span class=o>=</span><span class=s2>&#34;image&#34;</span>,<span class=s2>&#34;version&#34;</span><span class=o>=</span><span class=s2>&#34;0.1.0&#34;</span>...
</span></span><span class=line><span class=cl>  image 0: eu.gcr.io/acme/simpleserver:0.1.0-linux-amd64
</span></span><span class=line><span class=cl>  image 1: eu.gcr.io/acme/simpleserver:0.1.0-linux-arm64
</span></span><span class=line><span class=cl>  image 2: INDEX
</span></span><span class=line><span class=cl>locator: github.com/acme/simpleserver, repo: eu.gcr.io/acme/simpleserver, version 0.1.0</span></span></code></pre></div></figure></div><details><summary>What happened?</summary><p>The input type <code>dockermulti</code> is used to compose a multi-arch image on-the fly. Like
the input type <code>docker</code> it reads images from the local Docker daemon. In contrast to
this command you can list multiple images, created for different platforms, for which
an OCI index manifest is created to describe a multi-arch image. The complete set
of blobs is then packaged as artifact set archive and put as single resource into
the component version.</p><p>The resulting <code>component-descriptor.yaml</code> in <code>gen/ca</code> is:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>component:
</span></span><span class=line><span class=cl>  componentReferences: <span class=o>[]</span>
</span></span><span class=line><span class=cl>  name: github.com/acme/simpleserver
</span></span><span class=line><span class=cl>  provider: acme
</span></span><span class=line><span class=cl>  repositoryContexts: <span class=o>[]</span>
</span></span><span class=line><span class=cl>  resources:
</span></span><span class=line><span class=cl>  - access:
</span></span><span class=line><span class=cl>      localReference: sha256.9dd0f2cbae3b8e6eb07fa947c05666d544c0419a6e44bd607e9071723186333b
</span></span><span class=line><span class=cl>      mediaType: application/vnd.oci.image.manifest.v1+tar+gzip
</span></span><span class=line><span class=cl>      referenceName: github.com/acme/simpleserver/helloserver:0.1.0
</span></span><span class=line><span class=cl>      type: localBlob
</span></span><span class=line><span class=cl>    name: chart
</span></span><span class=line><span class=cl>    relation: <span class=nb>local</span>
</span></span><span class=line><span class=cl>    type: helmChart
</span></span><span class=line><span class=cl>    version: 0.1.0
</span></span><span class=line><span class=cl>  - access:
</span></span><span class=line><span class=cl>      localReference: sha256.4e26c7dd46e13c9b1672e4b28a138bdcb086e9b9857b96c21e12839827b48c0c
</span></span><span class=line><span class=cl>      mediaType: application/vnd.oci.image.index.v1+tar+gzip
</span></span><span class=line><span class=cl>      referenceName: github.com/acme/simpleserver/eu.gcr.io/acme/simpleserver:0.1.0
</span></span><span class=line><span class=cl>      type: localBlob
</span></span><span class=line><span class=cl>    name: image
</span></span><span class=line><span class=cl>    relation: <span class=nb>local</span>
</span></span><span class=line><span class=cl>    type: ociImage
</span></span><span class=line><span class=cl>    version: 0.1.0
</span></span><span class=line><span class=cl>  sources: <span class=o>[]</span>
</span></span><span class=line><span class=cl>  version: 0.1.0
</span></span><span class=line><span class=cl>meta:
</span></span><span class=line><span class=cl>  schemaVersion: v2</span></span></code></pre></div></figure></div><p>Note that there is only one resource of type <code>image</code> with media-type <code>application/vnd.oci.image.index.v1+tar+gzip</code>
which is the standard media type for multi-arch images.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ls -l gen/ca/blobs
</span></span><span class=line><span class=cl>total 24M
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> d058463 staff  24M Dec  <span class=m>1</span> 09:50 sha256.4e26c7dd46e13c9b1672e4b28a138bdcb086e9b9857b96c21e12839827b48c0c
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> d058463 staff 4.7K Dec  <span class=m>1</span> 09:50 sha256.9dd0f2cbae3b8e6eb07fa947c05666d544c0419a6e44bd607e9071723186333b</span></span></code></pre></div></figure></div><p>The file sha256.4e26&mldr; contains the multi-arch image packaged as OCI artifact set:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tar tvf gen/ca/blobs/sha256.4e26c7dd46e13c9b1672e4b28a138bdcb086e9b9857b96c21e12839827b48c0c
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>         <span class=m>741</span> Jan  <span class=m>1</span>  <span class=m>2022</span> index.json
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>          <span class=m>38</span> Jan  <span class=m>1</span>  <span class=m>2022</span> oci-layout
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>           <span class=m>0</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>     <span class=m>3051520</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.05ef21d763159987b9ec5cfb3377a61c677809552dcac3301c0bde4e9fd41bbb
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>         <span class=m>723</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.117f12f0012875471168250f265af9872d7de23e19f0d4ef05fbe99a1c9a6eb3
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>     <span class=m>6264832</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.1496e46acd50a8a67ce65bac7e7287440071ad8d69caa80bcf144892331a95d3
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>     <span class=m>6507520</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.66817c8096ad97c6039297dc984ebc17c5ac9325200bfa9ddb555821912adbe4
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>         <span class=m>491</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.75a096351fe96e8be1847a8321bd66535769c16b2cf47ac03191338323349355
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>     <span class=m>3051520</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.77192cf194ddc77d69087b86b763c47c7f2b0f215d0e4bf4752565cae5ce728d
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>        <span class=m>1138</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.91018e67a671bbbd7ab875c71ca6917484ce76cde6a656351187c0e0e19fe139
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>    <span class=m>17807360</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.91f7bcfdfda81b6c6e51b8e1da58b48759351fa4fae9e6841dd6031528f63b4a
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>        <span class=m>1138</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.992b3b72df9922293c05f156f0e460a220bf601fa46158269ce6b7d61714a084
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>    <span class=m>14755840</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.a83c9b56bbe0f6c26c4b1d86e6de3a4862755d208c9dfae764f64b210eafa58c
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>0</span> <span class=m>0</span>      <span class=m>0</span>         <span class=m>723</span> Jan  <span class=m>1</span>  <span class=m>2022</span> blobs/sha256.e624040295fb78a81f4b4b08b43b4de419f31f21074007df8feafc10dfb654e6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ tar xvf gen/ca/blobs/sha256.4e26c7dd46e13c9b1672e4b28a138bdcb086e9b9857b96c21e12839827b48c0c -O - index.json <span class=p>|</span> jq .
</span></span><span class=line><span class=cl>x index.json
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;schemaVersion&#34;</span>: 2,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;mediaType&#34;</span>: <span class=s2>&#34;application/vnd.oci.image.index.v1+json&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;manifests&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;mediaType&#34;</span>: <span class=s2>&#34;application/vnd.oci.image.manifest.v1+json&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;digest&#34;</span>: <span class=s2>&#34;sha256:e624040295fb78a81f4b4b08b43b4de419f31f21074007df8feafc10dfb654e6&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;size&#34;</span>: <span class=m>723</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;mediaType&#34;</span>: <span class=s2>&#34;application/vnd.oci.image.manifest.v1+json&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;digest&#34;</span>: <span class=s2>&#34;sha256:117f12f0012875471168250f265af9872d7de23e19f0d4ef05fbe99a1c9a6eb3&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;size&#34;</span>: <span class=m>723</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;mediaType&#34;</span>: <span class=s2>&#34;application/vnd.oci.image.index.v1+json&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;digest&#34;</span>: <span class=s2>&#34;sha256:75a096351fe96e8be1847a8321bd66535769c16b2cf47ac03191338323349355&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;size&#34;</span>: 491,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;annotations&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;org.opencontainers.image.ref.name&#34;</span>: <span class=s2>&#34;0.1.0&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;software.ocm/tags&#34;</span>: <span class=s2>&#34;0.1.0&#34;</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>]</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;annotations&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;software.ocm/main&#34;</span>: <span class=s2>&#34;sha256:75a096351fe96e8be1847a8321bd66535769c16b2cf47ac03191338323349355&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></figure></div></details><p>You can create a common transport archive from the component archive.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cm transfer ca gen/ca gen/ctf
</span></span><span class=line><span class=cl>transferring version <span class=s2>&#34;github.com/acme/simpleserver:0.1.0&#34;</span>...
</span></span><span class=line><span class=cl>...resource 0<span class=o>(</span>github.com/acme/simpleserver/helloserver:0.1.0<span class=o>)</span>...
</span></span><span class=line><span class=cl>...resource 1<span class=o>(</span>github.com/acme/simpleserver/eu.gcr.io/acme/simpleserver:0.1.0<span class=o>)</span>...
</span></span><span class=line><span class=cl>...adding component version...</span></span></code></pre></div></figure></div><p>Or you can push it directly to the OCM repository:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nv>OCMREPO</span><span class=o>=</span>ghcr.io/<span class=si>${</span><span class=nv>PROVIDER</span><span class=si>}</span>
</span></span><span class=line><span class=cl>$ ocm transfer ca gen/ca <span class=nv>$OCMREPO</span>
</span></span><span class=line><span class=cl>transferring version <span class=s2>&#34;github.com/acme/simpleserver:0.1.0&#34;</span>...
</span></span><span class=line><span class=cl>...resource 0<span class=o>(</span>github.com/acme/simpleserver/helloserver:0.1.0<span class=o>)</span>...
</span></span><span class=line><span class=cl>...resource 1<span class=o>(</span>github.com/acme/simpleserver/eu.gcr.io/acme/simpleserver:0.1.0<span class=o>)</span>...
</span></span><span class=line><span class=cl>...adding component version...</span></span></code></pre></div></figure></div><p>The repository now should contain three additional artifacts. Depending on the OCI registry and
the corresponding UI you may see that the uploaded OCI image is a multi-arch-image. For example on
GitHub packages under the attribute <code>OS/Arch</code> you can see two platforms, <code>linux/amd64</code> and
<code>linux/arm64</code></p><p>For automation and reuse purposes you may consider templating resource files and Makefiles (see below).</p><h2 id=using-makefiles>Using Makefiles<a href=#using-makefiles class=anchor aria-hidden=true>#</a></h2><p>Developing with the Open Component Model usually is an iterative process of building artifacts,
generating component descriptors, analyzing and finally publishing them. To simplify and speed up this
process it should be automated using a build tool. One option is to use a <code>Makefile</code>.
The following example can be used as a starting point and can be modified according to your needs.</p><p>In this example we will automate the same example as in the sections before:</p><ul><li>Creating a multi-arch image from Go sources from a Git repository using the Docker CLI</li><li>Packaging the image and a Helm chart into a common transport archive</li><li>Signing and publishing the build result</li></ul><h3 id=prerequisites>Prerequisites<a href=#prerequisites class=anchor aria-hidden=true>#</a></h3><ul><li>The OCM CLI must be installed and be available in your PATH</li><li>The Makefile is located in the top-level folder of a Git project</li><li>Operating system is Unix/Linux</li><li>A sub-directory <code>local</code> can be used for local settings e.g. environment varibles, RSA keys, &mldr;</li><li>A sub-directory <code>gen</code> will be used for generated artifacts from the <code>make build</code>command</li><li>It is recommended to add <code>local/</code> and <code>gen/</code> to the <code>.gitignore</code> file</li></ul><p>We use the following file system layout for the example:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tree .
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── Dockerfile
</span></span><span class=line><span class=cl>├── LICENSE
</span></span><span class=line><span class=cl>├── Makefile
</span></span><span class=line><span class=cl>├── README.md
</span></span><span class=line><span class=cl>├── go.mod
</span></span><span class=line><span class=cl>├── helmchart
</span></span><span class=line><span class=cl>│   ├── Chart.yaml
</span></span><span class=line><span class=cl>│   ├── templates
</span></span><span class=line><span class=cl>│   │   ├── NOTES.txt
</span></span><span class=line><span class=cl>│   │   ├── _helpers.tpl
</span></span><span class=line><span class=cl>│   │   ├── deployment.yaml
</span></span><span class=line><span class=cl>│   │   ├── hpa.yaml
</span></span><span class=line><span class=cl>│   │   ├── ingress.yaml
</span></span><span class=line><span class=cl>│   │   ├── service.yaml
</span></span><span class=line><span class=cl>│   │   ├── serviceaccount.yaml
</span></span><span class=line><span class=cl>│   │   └── tests
</span></span><span class=line><span class=cl>│   │       └── test-connection.yaml
</span></span><span class=line><span class=cl>│   └── values.yaml
</span></span><span class=line><span class=cl>├── <span class=nb>local</span>
</span></span><span class=line><span class=cl>│   └── env.sh
</span></span><span class=line><span class=cl>├── main.go
</span></span><span class=line><span class=cl>├── resources.yaml
</span></span><span class=line><span class=cl>└── VERSION</span></span></code></pre></div></figure></div><details><summary>This Makefile can be used</summary><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=nv>NAME</span>      <span class=o>?=</span> simpleserver
</span></span><span class=line><span class=cl><span class=nv>PROVIDER</span>  <span class=o>?=</span> acme.org
</span></span><span class=line><span class=cl><span class=nv>GITHUBORG</span> <span class=o>?=</span> acme
</span></span><span class=line><span class=cl><span class=nv>IMAGE</span>     <span class=o>=</span> ghcr.io/<span class=k>$(</span>GITHUBORG<span class=k>)</span>/demo/<span class=k>$(</span>NAME<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>COMPONENT</span> <span class=o>=</span> <span class=k>$(</span>PROVIDER<span class=k>)</span>/demo/<span class=k>$(</span>NAME<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>OCMREPO</span>   <span class=o>?=</span> ghcr.io/<span class=k>$(</span>GITHUBORG<span class=k>)</span>/ocm
</span></span><span class=line><span class=cl><span class=nv>MULTI</span>     <span class=o>?=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>PLATFORMS</span> <span class=o>?=</span> linux/amd64 linux/arm64
</span></span><span class=line><span class=cl><span class=nv>REPO_ROOT</span>           <span class=o>=</span> .
</span></span><span class=line><span class=cl><span class=nv>VERSION</span>             <span class=o>=</span> <span class=k>$(</span>shell git describe --tags --exact-match 2&gt;/dev/null<span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$$</span><span class=s2>(cat </span><span class=k>$(</span>REPO_ROOT<span class=k>)</span><span class=s2>/VERSION)&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>COMMIT</span>              <span class=o>=</span> <span class=k>$(</span>shell git rev-parse HEAD<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>EFFECTIVE_VERSION</span>   <span class=o>=</span> <span class=k>$(</span>VERSION<span class=k>)</span>-<span class=k>$(</span>COMMIT<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>GIT_TREE_STATE</span>      <span class=o>:=</span> <span class=k>$(</span>shell <span class=o>[</span> -z <span class=s2>&#34;</span><span class=k>$(</span>git status --porcelain 2&gt;/dev/null<span class=k>)</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> clean <span class=o>||</span> <span class=nb>echo</span> dirty<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>GEN</span> <span class=o>=</span> ./gen
</span></span><span class=line><span class=cl><span class=nv>OCM</span> <span class=o>=</span> ocm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>CHART_SRCS</span><span class=o>=</span><span class=k>$(</span>shell find helmchart -type f<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>GO_SRCS</span><span class=o>=</span><span class=k>$(</span>shell find . -name <span class=se>\*</span>.go -type f<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>ifeq</span> <span class=err>(</span><span class=k>$(</span><span class=nv>MULTI</span><span class=k>)</span><span class=err>,true)</span>
</span></span><span class=line><span class=cl><span class=nv>FLAGSUF</span>     <span class=o>=</span> .multi
</span></span><span class=line><span class=cl><span class=err>endif</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>build</span>
</span></span><span class=line><span class=cl><span class=nf>build</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>build</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>version</span>
</span></span><span class=line><span class=cl><span class=nf>version</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	@echo <span class=k>$(</span>VERSION<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>ca</span>
</span></span><span class=line><span class=cl><span class=nf>ca</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>ca</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(GEN)/ca</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/.<span class=n>exists</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>image</span>.<span class=k>$(</span><span class=nv>NAME</span><span class=k>)$(</span><span class=nv>FLAGSUF</span><span class=k>)</span> <span class=n>resources</span>.<span class=n>yaml</span> <span class=k>$(</span><span class=nv>CHART_SRCS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	<span class=k>$(</span>OCM<span class=k>)</span> create ca -f <span class=k>$(</span>COMPONENT<span class=k>)</span> <span class=s2>&#34;</span><span class=k>$(</span>VERSION<span class=k>)</span><span class=s2>&#34;</span> --provider <span class=k>$(</span>PROVIDER<span class=k>)</span> --file <span class=k>$(</span>GEN<span class=k>)</span>/ca
</span></span><span class=line><span class=cl>	<span class=k>$(</span>OCM<span class=k>)</span> add resources --templater spiff <span class=k>$(</span>GEN<span class=k>)</span>/ca <span class=nv>COMMIT</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>COMMIT<span class=k>)</span><span class=s2>&#34;</span> <span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>VERSION<span class=k>)</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>		<span class=nv>IMAGE</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>IMAGE<span class=k>)</span><span class=s2>:</span><span class=k>$(</span>VERSION<span class=k>)</span><span class=s2>&#34;</span> <span class=nv>PLATFORMS</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>PLATFORMS<span class=k>)</span><span class=s2>&#34;</span> <span class=nv>MULTI</span><span class=o>=</span><span class=k>$(</span>MULTI<span class=k>)</span> resources.yaml
</span></span><span class=line><span class=cl>	@touch <span class=k>$(</span>GEN<span class=k>)</span>/ca
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(GEN)/build</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GO_SRCS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	go build .
</span></span><span class=line><span class=cl>	@touch <span class=k>$(</span>GEN<span class=k>)</span>/build
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>image</span>
</span></span><span class=line><span class=cl><span class=nf>image</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>image</span>.<span class=k>$(</span><span class=nv>NAME</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(GEN)/image.$(NAME)</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/.<span class=n>exists</span> <span class=n>Dockerfile</span> <span class=k>$(</span><span class=nv>OCMSRCS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	docker build -t <span class=k>$(</span>IMAGE<span class=k>)</span>:<span class=k>$(</span>VERSION<span class=k>)</span> --file Dockerfile <span class=k>$(</span>COMPONENT_ROOT<span class=k>)</span> .<span class=p>;</span>
</span></span><span class=line><span class=cl>	@touch <span class=k>$(</span>GEN<span class=k>)</span>/image.<span class=k>$(</span>NAME<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>multi</span>
</span></span><span class=line><span class=cl><span class=nf>multi</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>image</span>.<span class=k>$(</span><span class=nv>NAME</span><span class=k>)</span>.<span class=n>multi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(GEN)/image.$(NAME).multi</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/.<span class=n>exists</span> <span class=n>Dockerfile</span> <span class=k>$(</span><span class=nv>GO_SRCS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;Building Multi </span><span class=k>$(</span>PLATFORMS<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> i in <span class=k>$(</span>PLATFORMS<span class=k>)</span><span class=p>;</span> <span class=k>do</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=nv>tag</span><span class=o>=</span><span class=nv>$$</span><span class=o>(</span><span class=nb>echo</span> <span class=nv>$$</span>i <span class=p>|</span> sed -e s:/:-:g<span class=o>)</span><span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=nb>echo</span> <span class=s2>&#34;Building platform </span><span class=nv>$$</span><span class=s2>i with tag: </span><span class=nv>$$</span><span class=s2>tag&#34;</span><span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	docker buildx build --load -t <span class=k>$(</span>IMAGE<span class=k>)</span>:<span class=k>$(</span>VERSION<span class=k>)</span>-<span class=nv>$$</span>tag --platform <span class=nv>$$</span>i .<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=k>done</span>
</span></span><span class=line><span class=cl>	@touch <span class=k>$(</span>GEN<span class=k>)</span>/image.<span class=k>$(</span>NAME<span class=k>)</span>.multi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>ctf</span>
</span></span><span class=line><span class=cl><span class=nf>ctf</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>ctf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(GEN)/ctf</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>ca</span>
</span></span><span class=line><span class=cl>	@rm -rf <span class=k>$(</span>GEN<span class=k>)</span>/ctf
</span></span><span class=line><span class=cl>	<span class=k>$(</span>OCM<span class=k>)</span> transfer ca <span class=k>$(</span>GEN<span class=k>)</span>/ca <span class=k>$(</span>GEN<span class=k>)</span>/ctf
</span></span><span class=line><span class=cl>	touch <span class=k>$(</span>GEN<span class=k>)</span>/ctf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>push</span>
</span></span><span class=line><span class=cl><span class=nf>push</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>ctf</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>push</span>.<span class=k>$(</span><span class=nv>NAME</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(GEN)/push.$(NAME)</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>ctf</span>
</span></span><span class=line><span class=cl>	<span class=k>$(</span>OCM<span class=k>)</span> transfer ctf -f <span class=k>$(</span>GEN<span class=k>)</span>/ctf <span class=k>$(</span>OCMREPO<span class=k>)</span>
</span></span><span class=line><span class=cl>	@touch <span class=k>$(</span>GEN<span class=k>)</span>/push.<span class=k>$(</span>NAME<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>transport</span>
</span></span><span class=line><span class=cl><span class=nf>transport</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=err>ifneq</span> <span class=err>(</span><span class=k>$(</span><span class=nv>TARGETREPO</span><span class=k>)</span><span class=err>,)</span>
</span></span><span class=line><span class=cl>	<span class=nf>$(OCM) transfer component -Vc  $(OCMREPO)//$(COMPONENT)</span><span class=o>:</span><span class=k>$(</span><span class=nv>VERSION</span><span class=k>)</span> <span class=k>$(</span><span class=nv>TARGETREPO</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=err>else</span>
</span></span><span class=line><span class=cl>	<span class=err>@echo</span> <span class=s2>&#34;Cannot transport no TARGETREPO defined as destination&#34;</span> <span class=err>&amp;&amp;</span> <span class=err>exit</span> <span class=err>1</span>
</span></span><span class=line><span class=cl><span class=err>endif</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(GEN)/.exists</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	@mkdir -p <span class=k>$(</span>GEN<span class=k>)</span>
</span></span><span class=line><span class=cl>	@touch <span class=nv>$@</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>info</span>
</span></span><span class=line><span class=cl><span class=nf>info</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	@echo <span class=s2>&#34;VERSION:  </span><span class=k>$(</span>VERSION<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>	@echo <span class=s2>&#34;COMMIT:   </span><span class=k>$(</span>COMMIT<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>	@echo <span class=s2>&#34;TREESTATE:   </span><span class=k>$(</span>GIT_TREE_STATE<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>describe</span>
</span></span><span class=line><span class=cl><span class=nf>describe</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>ctf</span>
</span></span><span class=line><span class=cl>	ocm get resources --lookup <span class=k>$(</span>OCMREPO<span class=k>)</span> -r -o treewide <span class=k>$(</span>GEN<span class=k>)</span>/ctf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>descriptor</span>
</span></span><span class=line><span class=cl><span class=nf>descriptor</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>ctf</span>
</span></span><span class=line><span class=cl>	ocm get component -S v3alpha1 -o yaml <span class=k>$(</span>GEN<span class=k>)</span>/ctf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>clean</span>
</span></span><span class=line><span class=cl><span class=nf>clean</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	rm -rf <span class=k>$(</span>GEN<span class=k>)</span>
</span></span></code></pre></div></figure></div></details><p>The Makefile supports the following targets:</p><ul><li><code>build</code> (default) simple Go build</li><li><code>version</code> show current VERSION of Github repository</li><li><code>image</code> build a local Docker image</li><li><code>multi</code> build multi-arch images with Docker</li><li><code>ca</code> execute build and create a component archive</li><li><code>ctf</code> create a common transport format archive</li><li><code>push</code> push the common transport archive to an OCI registry</li><li><code>info</code> show variables used in Makefile (version, commit, etc.)</li><li><code>describe</code> display the component version in a tree-form</li><li><code>descriptor</code> show the component descriptor of the component version</li><li><code>transport</code> transport the component from the upload repository into another OCM repository</li><li><code>clean</code> delete all generated files (but does not delete Docker images)</li></ul><p>The variables assigned with <code>?=</code> at the beginning can be set from outside and override the default
declared in the Makefile. Use either an environment variable or an argument when calling <code>make</code>.</p><p>Example:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nv>PROVIDER</span><span class=o>=</span>foo make ca</span></span></code></pre></div></figure></div><h3 id=templating-the-resources>Templating the Resources<a href=#templating-the-resources class=anchor aria-hidden=true>#</a></h3><p>The Makefile uses a dynamic list of generated platforms for the images. You can just set the <code>PLATFORMS</code> variable:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=nv>MULTI</span>     <span class=o>?=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>PLATFORMS</span> <span class=o>?=</span> linux/amd64 linux/arm64
</span></span></code></pre></div></figure></div><p>If <code>MULTI</code> is set to <code>true</code>, the variable <code>PLATFORMS</code> will be evaluated to decide which image variants
will be built. This has to be reflected in the <code>resources.yaml</code>. It has to use the input type
<code>dockermulti</code> and list all the variants which should be packaged into a multi-arch image. This list
depends on the content of the Make variable.</p><p>The OCM CLI supports this by enabling templating mechanisms for the content by selecting a templater
using the option <code>--templater ...</code>. The example uses the <a href=https://github.com/mandelsoft/spiff>Spiff templater</a>.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=nf>$(GEN)/ca</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/.<span class=n>exists</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/<span class=n>image</span>.<span class=k>$(</span><span class=nv>NAME</span><span class=k>)$(</span><span class=nv>FLAGSUF</span><span class=k>)</span> <span class=n>resources</span>.<span class=n>yaml</span> <span class=k>$(</span><span class=nv>CHART_SRCS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	<span class=k>$(</span>OCM<span class=k>)</span> create ca -f <span class=k>$(</span>COMPONENT<span class=k>)</span> <span class=s2>&#34;</span><span class=k>$(</span>VERSION<span class=k>)</span><span class=s2>&#34;</span> --provider <span class=k>$(</span>PROVIDER<span class=k>)</span> --file <span class=k>$(</span>GEN<span class=k>)</span>/ca
</span></span><span class=line><span class=cl>	<span class=k>$(</span>OCM<span class=k>)</span> add resources --templater spiff <span class=k>$(</span>GEN<span class=k>)</span>/ca <span class=nv>COMMIT</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>COMMIT<span class=k>)</span><span class=s2>&#34;</span> <span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>VERSION<span class=k>)</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>		<span class=nv>IMAGE</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>IMAGE<span class=k>)</span><span class=s2>:</span><span class=k>$(</span>VERSION<span class=k>)</span><span class=s2>&#34;</span> <span class=nv>PLATFORMS</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>PLATFORMS<span class=k>)</span><span class=s2>&#34;</span> <span class=nv>MULTI</span><span class=o>=</span><span class=k>$(</span>MULTI<span class=k>)</span> resources.yaml
</span></span><span class=line><span class=cl>	@touch <span class=k>$(</span>GEN<span class=k>)</span>/ca
</span></span></code></pre></div></figure></div><p>The variables given to the <code>add resources</code> command are passed to the templater. The template looks
like:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ociImage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>(( values.VERSION ))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>(( bool(values.MULTI) ? &#34;dockermulti&#34; :&#34;docker&#34; ))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>repository</span><span class=p>:</span><span class=w>  </span><span class=l>(( index(values.IMAGE, &#34;:&#34;) &gt;= 0 ? substr(values.IMAGE,0,index(values.IMAGE,&#34;:&#34;)) :values.IMAGE ))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variants</span><span class=p>:</span><span class=w> </span><span class=l>(( bool(values.MULTI) ? map[split(&#34; &#34;, values.PLATFORMS)|v|-&gt; values.IMAGE &#34;-&#34; replace(v,&#34;/&#34;,&#34;-&#34;)] :~~ ))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>(( bool(values.MULTI) ? ~~ :values.IMAGE ))</span></span></span></code></pre></div></figure></div><p>By using a variable <code>values.MULTI</code>, the command distinguishes between a single Docker image and a multi-arch image.
With <code>map[]</code>, the platform list from the Makefile is mapped to a list of tags created by the
<code>docker buildx</code> command used in the Makefile. The value <code>~~</code> is used to undefine the yaml fields not
required for the selected case (the template can be used for multi- and single-arch builds).</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=nf>$(GEN)/image.$(NAME).multi</span><span class=o>:</span> <span class=k>$(</span><span class=nv>GEN</span><span class=k>)</span>/.<span class=n>exists</span> <span class=n>Dockerfile</span> <span class=k>$(</span><span class=nv>GO_SRCS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;Building Multi </span><span class=k>$(</span>PLATFORMS<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> i in <span class=k>$(</span>PLATFORMS<span class=k>)</span><span class=p>;</span> <span class=k>do</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=nv>tag</span><span class=o>=</span><span class=nv>$$</span><span class=o>(</span><span class=nb>echo</span> <span class=nv>$$</span>i <span class=p>|</span> sed -e s:/:-:g<span class=o>)</span><span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=nb>echo</span> <span class=s2>&#34;Building platform </span><span class=nv>$$</span><span class=s2>i with tag: </span><span class=nv>$$</span><span class=s2>tag&#34;</span><span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	docker buildx build --load -t <span class=k>$(</span>IMAGE<span class=k>)</span>:<span class=k>$(</span>VERSION<span class=k>)</span>-<span class=nv>$$</span>tag --platform <span class=nv>$$</span>i .<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=k>done</span>
</span></span><span class=line><span class=cl>	@touch <span class=k>$(</span>GEN<span class=k>)</span>/image.<span class=k>$(</span>NAME<span class=k>)</span>.multi
</span></span></code></pre></div></figure></div><h2 id=pipeline-integration>Pipeline Integration<a href=#pipeline-integration class=anchor aria-hidden=true>#</a></h2><p>Pipeline infrastructures are heterogenous, so there is no universal answer how to
integrate a build pipeline with OCM. Usually, the simplest way is using the OCM command line interface.
Following you will find an example using GitHub actions.</p><p>There are two repositories dealing with GitHub actions:
The <a href=https://github.com/open-component-model/ocm-action>first one</a> provides various actions that can be
called from a workflow. The <a href=https://github.com/open-component-model/ocm-setup-action>second one</a>
provides the required installations of the OCM parts into the container.</p><p>An typical workflow for a build step will create a component version and a transport archive:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>create-ocm</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>setup OCM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>open-component-model/ocm-setup-action@main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>create OCM component version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>open-component-model/ocm-action@main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>create_component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class=l>acme.org/demo/simpleserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>${{ env.PROVIDER }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>github.com/jensh007</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>...</span></span></span></code></pre></div></figure></div><p>This creates a component version for the current build. Additionally, a transport archive
may be created or the component version along with the built container images may be uploaded to an
OCI registry, etc.</p><p>More documentation is available <a href=https://github.com/open-component-model/ocm-action>here</a>. A full
example can be found in the sample Github repository.</p><h2 id=static-and-dynamic-variable-substitution>Static and Dynamic Variable Substitution<a href=#static-and-dynamic-variable-substitution class=anchor aria-hidden=true>#</a></h2><p>Looking at the <a href=https://github.com/open-component-model/ocm-website/blob/main/content/docs/tutorials/structuring-software-with-ocm.md#building-the-common-transport-archive>settings file</a> shows that
some variables like the <code>version</code> or the <code>commit</code> change with every build
or release. In many cases, these variables will be auto-generated during the build.</p><p>Other variables like the version of 3rd-party components will just change from time to
time and are often set manually by an engineer or release manager. It is useful to separate
between static and dynamic variables. Static files can be checked-in into the source control system and
are maintained manually. Dynamic variables can be generated during build.</p><p>Example:
manually maintained:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>NAME</span><span class=p>:</span><span class=w> </span><span class=l>microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>COMPONENT_NAME_PREFIX</span><span class=p>:</span><span class=w> </span><span class=l>github.com/acme.org/microblog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=l>ocm.software</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ELASTIC_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>8.5.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>MARIADB_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>10.6.11</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>MARIADB_CHART_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>11.4.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>NGINX_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>1.5.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>NGINX_CHART_VERSION</span><span class=p>:</span><span class=w> </span><span class=m>4.4.2</span></span></span></code></pre></div></figure></div><p>auto-generated from a build script:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>VERSION</span><span class=p>:</span><span class=w> </span><span class=m>0.23.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>COMMIT</span><span class=p>:</span><span class=w> </span><span class=l>5f03021059c7dbe760ac820a014a8a84166ef8b4</span></span></span></code></pre></div></figure></div><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocm add componentversions --create --file ../gen/ctf --settings ../gen/dynamic_settings.yaml --settings static_settings.yaml component-constructor.yaml</span></span></code></pre></div></figure></div><h2 id=debugging-explain-the-blobs-directory>Debugging: Explain the Blobs Directory<a href=#debugging-explain-the-blobs-directory class=anchor aria-hidden=true>#</a></h2><p>For analyzing and debugging the content of a transport archive, there are some supportive commands
to analyze what is contained in the archive and what is stored in which blob:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tree ../gen/ctf
</span></span><span class=line><span class=cl>../gen/ctf
</span></span><span class=line><span class=cl>├── artifact-index.json
</span></span><span class=line><span class=cl>└── blobs
</span></span><span class=line><span class=cl>    ├── ...
</span></span><span class=line><span class=cl>    ├── sha256.59ff88331c53a2a94cdd98df58bc6952f056e4b2efc8120095fbc0a870eb0b67
</span></span><span class=line><span class=cl>    ├── ...</span></span></code></pre></div></figure></div><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocm get resources -r -o wide ../gen/ctf
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>REFERENCEPATH: github.com/acme.org/microblog/nginx-controller:1.5.1
</span></span><span class=line><span class=cl>NAME         : nginx-controller-chart
</span></span><span class=line><span class=cl>VERSION      : 1.5.1
</span></span><span class=line><span class=cl>IDENTITY     :
</span></span><span class=line><span class=cl>TYPE         : helmChart
</span></span><span class=line><span class=cl>RELATION     : <span class=nb>local</span>
</span></span><span class=line><span class=cl>ACCESSTYPE   : localBlob
</span></span><span class=line><span class=cl>ACCESSSPEC   : <span class=o>{</span><span class=s2>&#34;localReference&#34;</span>:<span class=s2>&#34;sha256:59ff88331c53a2a94cdd98df58bc6952f056e4b2efc8120095fbc0a870eb0b67&#34;</span>,<span class=s2>&#34;mediaType&#34;</span>:<span class=s2>&#34;application/vnd.oci.image.manifest.v1+tar+gzip&#34;</span>,<span class=s2>&#34;referenceName&#34;</span>:<span class=s2>&#34;github.com/acme.org/microblog/nginx-controller/ingress-nginx:4.4.2&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>...</span></span></code></pre></div></figure></div><h2 id=self-contained-transport-archives>Self-Contained Transport Archives<a href=#self-contained-transport-archives class=anchor aria-hidden=true>#</a></h2><p>The transport archive created from a component-constructor file, using the command <code>ocm add componentversions --create ...</code>, does not automatically resolve image references to external OCI registries and stores them in the archive. If you want to create a self-contained transport archive with all images stored as local artifacts, you need to use the <code>--copy-resources</code> option of the <code>ocm transfer ctf</code> command. This will copy all external images to the blobs directory of the archive.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocm transfer ctf --copy-resources &lt;ctf-dir&gt; &lt;new-ctf-dir-or-oci-repo-url&gt;</span></span></code></pre></div></figure></div><p>Note that this archive can become huge if there an many external images involved!</p><h2 id=cicd-integration>CICD Integration<a href=#cicd-integration class=anchor aria-hidden=true>#</a></h2><p>Configure rarely changing variables in a static file and generate dynamic variables
during the build from the environment. See the <a href=#static-and-dynamic-variable-substitution>Static and Dynamic Variable Substitution</a> section above.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/docs/tutorials/ocm-and-gitops/air-gapped-gitops-with-ocm-flux/ class="stretched-link text-reset text-decoration-none">Air-gapped GitOps with OCM & Flux</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/docs/tutorials/build-deploy-infrastructure-via-helm-charts-with-ocm/ class="stretched-link text-reset text-decoration-none">Build & Deploy Infrastructure via Helm Charts with OCM</a></div><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/privacy/>Privacy Policy</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item><small>© Copyright 2024, <a href=https://www.sap.com/corporate/en/legal/copyright.html>SAP SE </a>and Open Component Model Contributors | <a href=https://www.sap.com/about/legal/trademark.html>Trademark </a>| <a href=/privacy-policy/>Privacy Policy</a> | <a href=https://www.sap.com/corporate/en/legal/terms-of-use.html>Terms of Use</a> | <a href=https://www.sap.com/corporate/en/legal/impressum.html>Legal Disclosure</a></small></li></ul></div></div></div></footer><script async src=/js/app.47b84f3b640408af6efe7bf4add1a36f5b9c6227fbae7b8bcdf0c9ce42fefc54.js integrity="sha256-R7hPO2QECK9u/nv0rdGjb1ucYif7rnuLzfDJzkL+/FQ="></script><script type=text/javascript async src=https://play.vidyard.com/embed/v4.js></script><script async src=/js/flexsearch.b6f80717bc68cd38b6ded7a061f96a73896db6be17a6582f09a63a6040040919.js integrity="sha256-tvgHF7xozTi23tegYflqc4lttr4XplgvCaY6YEAECRk="></script><script async src=/js/search-modal.4e30271fef6fac86c3b4143167e9784bd3f7037ce1045d03a321e7e799e91476.js integrity="sha256-TjAnH+9vrIbDtBQxZ+l4S9P3A3zhBF0DoyHn55npFHY="></script></body></html>