<!doctype html><html lang=en data-bs-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ocm.software/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href="/main.04c851dbe3c9395f223f0031c0f08d2af490e95665730a8018212d23ced34f6a6d6fd5f33c5253277168d1b77078daecfd0ea2a111d5b47f5470e6b0679c0018.css" integrity="sha512-BMhR2+PJOV8iPwAxwPCNKvSQ6VZlcwqAGCEtI87TT2ptb9XzPFJTJ3Fo0bdweNrs/Q6ioRHVtH9UcOawZ5wAGA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://ocm.software/mpas/getting_started/><link rel=canonical href=https://ocm.software/mpas/getting_started/><title>Get Started with MPAS | Open Component Model</title>
<meta name=description content><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:title" content="Get Started with MPAS"><meta property="og:description" content="This tutorial shows you how to bootstrap MPAS to a Kubernetes cluster and deploy a simple application.
Prerequisites A Kubernetes cluster A GitHub access token with repo scope kubectl Objectives Bootstrap MPAS to a Kubernetes cluster Deploy a simple application Install the MPAS CLI The MPAS CLI is the primary tool for interacting with MPAS."><meta property="og:type" content="article"><meta property="og:url" content="https://ocm.software/mpas/getting_started/"><meta property="og:image" content="https://ocm.software/logo-image.png"><meta property="article:section" content="mpas"><meta property="article:published_time" content="2023-09-12T10:37:58+01:00"><meta property="article:modified_time" content="2023-11-03T10:53:00+01:00"><meta property="og:site_name" content="Open Component Model"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ocm.software/logo-image.png"><meta name=twitter:title content="Get Started with MPAS"><meta name=twitter:description content="This tutorial shows you how to bootstrap MPAS to a Kubernetes cluster and deploy a simple application.
Prerequisites A Kubernetes cluster A GitHub access token with repo scope kubectl Objectives Bootstrap MPAS to a Kubernetes cluster Deploy a simple application Install the MPAS CLI The MPAS CLI is the primary tool for interacting with MPAS."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://ocm.software/","name":"Open Component Model","position":1},{"@type":"ListItem","item":"https://ocm.software/mpas/","name":"Mpas","position":2},{"@type":"ListItem","name":"Get Started With Mpas","position":3}]}</script></head><body class="single section mpas" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand order-0" href=/ aria-label="Open Component Model"><img src=/images/logo-horizontal-white-text.png alt="Open Component Model Logo" class=header-logo>
</a><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>Open Component Model</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://ocm.software/docs/overview/context>Docs</a></li><li class=nav-item><a class=nav-link href=https://ocm.software/docs/cli/spec/specification>Spec</a></li><li class=nav-item><a class=nav-link href=https://ocm.software/project/about>Project</a></li><li class=nav-item><a class=nav-link href=https://ocm.software/docs/community/community/>Community</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/open-component-model><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://kubernetes.slack.com/archives/C05UWBE8R1D><svg role="img" width="22" height="22" viewBox="0 0 24 24" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M5.042 15.165a2.528 2.528.0 01-2.52 2.523A2.528 2.528.0 010 15.165a2.527 2.527.0 012.522-2.52h2.52v2.52zm1.271.0a2.527 2.527.0 012.521-2.52 2.527 2.527.0 012.521 2.52v6.313A2.528 2.528.0 018.834 24a2.528 2.528.0 01-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528.0 01-2.521-2.52A2.528 2.528.0 018.834.0a2.528 2.528.0 012.521 2.522v2.52H8.834zm0 1.271a2.528 2.528.0 012.521 2.521 2.528 2.528.0 01-2.521 2.521H2.522A2.528 2.528.0 010 8.834a2.528 2.528.0 012.522-2.521h6.312zM18.956 8.834a2.528 2.528.0 012.522-2.521A2.528 2.528.0 0124 8.834a2.528 2.528.0 01-2.522 2.521h-2.522V8.834zm-1.268.0a2.528 2.528.0 01-2.523 2.521 2.527 2.527.0 01-2.52-2.521V2.522A2.527 2.527.0 0115.165.0a2.528 2.528.0 012.523 2.522v6.312zM15.165 18.956a2.528 2.528.0 012.523 2.522A2.528 2.528.0 0115.165 24a2.527 2.527.0 01-2.52-2.522v-2.522h2.52zm0-1.268a2.527 2.527.0 01-2.52-2.523 2.526 2.526.0 012.52-2.52h6.313A2.527 2.527.0 0124 15.165a2.528 2.528.0 01-2.522 2.523h-6.313z"/></svg><small class="ms-2 visually-hidden">Slack</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-fluid" role=document><div class=content><div class="container p-0"><div class="row flex-xl-nowrap"><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#objectives>Objectives</a></li><li><a href=#install-the-mpas-cli>Install the MPAS CLI</a></li><li><a href=#bootstrap-mpas>Bootstrap MPAS</a><ul><li><a href=#export-your-github-access-token>Export your GitHub access token</a></li><li><a href=#bootstrap-mpas-1>Bootstrap MPAS</a></li><li><a href=#deploy-podinfo-application>Deploy podinfo application</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Get Started with MPAS</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#objectives>Objectives</a></li><li><a href=#install-the-mpas-cli>Install the MPAS CLI</a></li><li><a href=#bootstrap-mpas>Bootstrap MPAS</a><ul><li><a href=#export-your-github-access-token>Export your GitHub access token</a></li><li><a href=#bootstrap-mpas-1>Bootstrap MPAS</a></li><li><a href=#deploy-podinfo-application>Deploy podinfo application</a></li></ul></li></ul></nav></div></details></nav><p>This tutorial shows you how to bootstrap MPAS to a Kubernetes cluster and deploy
a simple application.</p><h2 id=prerequisites>Prerequisites<a href=#prerequisites class=anchor aria-hidden=true>#</a></h2><ul><li>A Kubernetes cluster</li><li>A GitHub access token with <code>repo</code> scope</li><li>kubectl</li></ul><h2 id=objectives>Objectives<a href=#objectives class=anchor aria-hidden=true>#</a></h2><ul><li>Bootstrap MPAS to a Kubernetes cluster</li><li>Deploy a simple application</li></ul><h2 id=install-the-mpas-cli>Install the MPAS CLI<a href=#install-the-mpas-cli class=anchor aria-hidden=true>#</a></h2><p>The MPAS CLI is the primary tool for interacting with MPAS. It can be used to
bootstrap MPAS to a Kubernetes cluster.</p><p>To install the MPAS CLI using <code>brew</code>:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install open-component-model/tap/mpas</span></span></code></pre></div></figure></div><p>For other installation methods, see the <a href=/mpas/overview/installation/>installation guide</a>.</p><h2 id=bootstrap-mpas>Bootstrap MPAS<a href=#bootstrap-mpas class=anchor aria-hidden=true>#</a></h2><h3 id=export-your-github-access-token>Export your GitHub access token<a href=#export-your-github-access-token class=anchor aria-hidden=true>#</a></h3><p>The MPAS CLI uses your GitHub access token to authenticate with GitHub. To create a
GitHub access token, see the <a href=https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token>GitHub documentation</a>. In addition to that we need to export your GitHub user and an your email address as they are used later.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GITHUB_TOKEN</span><span class=o>=</span>&lt;your-github-access-token&gt;
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GITHUB_USER</span><span class=o>=</span>&lt;your-username&gt;
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>MY_EMAIL</span><span class=o>=</span>&lt;your-email-address&gt;</span></span></code></pre></div></figure></div><h3 id=bootstrap-mpas-1>Bootstrap MPAS<a href=#bootstrap-mpas-1 class=anchor aria-hidden=true>#</a></h3><p>To bootstrap MPAS to your Kubernetes cluster, run the following command. If nothing is specified it will use the KUBECONFIG specified in the user&rsquo;s environment. It is also possible to specify a dedicated config using the &ndash;kubeconfig option.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mpas bootstrap github <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --owner<span class=o>=</span><span class=nv>$GITHUB_USER</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --repository<span class=o>=</span>mpas-bootstrap <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --path<span class=o>=</span>./clusters/my-cluster <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --personal</span></span></code></pre></div></figure></div><p>This command will create a new Github repository called <code>mpas-bootstrap</code> and bootstrap
MPAS to your Kubernetes cluster. The following components will be installed:</p><ul><li><a href=https://fluxcd.io/docs/components/>Flux</a>: A Kubernetes operator that will
install and manage the other components.</li><li><a href=https://github.com/open-component-model/ocm-controller>ocm-controller</a>: A Kubernetes controller
that enables the automated deployment of software components using the Open Component Model and Flux.</li><li><a href=https://github.com/open-component-model/git-controller>git-controller</a>: A
Kubernetes controller that will create pull requests in the target Github repository
when changes are made to the cluster.</li><li><a href=https://github.com/open-component-model/replication-controller>replication-controller</a>: A Kubernetes controller that
keeps keep component versions in the cluster up-to-date with a version defined by the consumer in the <code>ComponentSubscription</code> resource.</li><li><a href=https://github.com/open-component-model/mpas-product-controller>mpas-product-controller</a>: A Kubernetes controller, responsible for creating a product. Reconciles the <code>Product</code> resource.</li><li><a href=https://github.com/open-component-model/mpas-project-controller>mpas-project-controller</a>: A Kubernetes controller responsible for bootstrapping a whole project. Creates relevant access credentials, service accounts, roles and the main GitOps repository and
reconciles the <code>Project</code> resource.</li></ul><p>The output of the bootstrap is similar to the following:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Running mpas bootstrap ...
</span></span><span class=line><span class=cl> ✓   Preparing Management repository mpas-bootstrap
</span></span><span class=line><span class=cl> ✓   Fetching bootstrap component from ghcr.io/open-component-model/mpas-bootstrap-component
</span></span><span class=line><span class=cl> ✓   Installing flux with version v2.1.0
</span></span><span class=line><span class=cl> ✓   Installing cert-manager with version v1.13.1
</span></span><span class=line><span class=cl> ✓   Reconciling infrastructure components
</span></span><span class=line><span class=cl> ✓   Waiting <span class=k>for</span> cert-manager to be available
</span></span><span class=line><span class=cl> ✓   Generating external-secrets-operator manifest with version v0.9.6
</span></span><span class=line><span class=cl> ✓   Generating git-controller manifest with version v0.9.0
</span></span><span class=line><span class=cl> ✓   Generating mpas-product-controller manifest with version v0.6.0
</span></span><span class=line><span class=cl> ✓   Generating mpas-project-controller manifest with version v0.5.0
</span></span><span class=line><span class=cl> ✓   Generating ocm-controller manifest with version v0.14.1
</span></span><span class=line><span class=cl> ✓   Generating replication-controller manifest with version v0.8.0
</span></span><span class=line><span class=cl> ✓   Generate certificate manifests
</span></span><span class=line><span class=cl> ✓   Reconciling infrastructure components
</span></span><span class=line><span class=cl> ✓   Waiting <span class=k>for</span> components to be ready
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Bootstrap completed successfully!</span></span></code></pre></div></figure></div><p>After completing the bootstrap process, the target github repository will contain
yaml manifests for the components to be installed on the cluster and Flux will
apply all of them to get the components installed. Furthermore the installed <code>Flux</code> components will
be configured to watch the target github repository for changes in the path <code>./clusters/my-cluster</code>.</p><h4 id=clone-the-git-repository>Clone the git repository<a href=#clone-the-git-repository class=anchor aria-hidden=true>#</a></h4><p>Clone the <code>mpas-bootstrap</code> repository to your local machine:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git clone https://github.com/<span class=nv>$GITHUB_USER</span>/mpas-bootstrap
</span></span><span class=line><span class=cl><span class=nb>cd</span> mpas-bootstrap</span></span></code></pre></div></figure></div><h3 id=deploy-podinfo-application>Deploy podinfo application<a href=#deploy-podinfo-application class=anchor aria-hidden=true>#</a></h3><p>The <a href=https://github.com/stefanprodan/podinfo>podinfo application</a> has been packaged
as an OCM component and can be retrieved from <a href=ghcr.io/open-component-model/podinfo>Github</a>.</p><ol><li>Create a secret containing your GitHub credentials that will be used by MPAS to
create your project repository.</li></ol><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create secret generic <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  github-access <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --from-literal<span class=o>=</span><span class=nv>username</span><span class=o>=</span><span class=nv>$GITHUB_USER</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --from-literal<span class=o>=</span><span class=nv>password</span><span class=o>=</span><span class=nv>$GITHUB_TOKEN</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -n mpas-system</span></span></code></pre></div></figure></div><ol start=2><li>Create a project that will contain the podinfo application.</li></ol><p>Let&rsquo;s create a directory for the project:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p ./clusters/my-cluster/podinfo</span></span></code></pre></div></figure></div><p>Then, create a <code>project.yaml</code> file in the <code>./clusters/my-cluster/podinfo</code> directory:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mpas create project podinfo-application <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --owner<span class=o>=</span><span class=nv>$GITHUB_USER</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --provider<span class=o>=</span>github <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --visibility<span class=o>=</span>public <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --already-exists-policy<span class=o>=</span>fail <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --branch<span class=o>=</span>main <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --secret-ref<span class=o>=</span>github-access <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --email<span class=o>=</span><span class=nv>$MY_EMAIL</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --message<span class=o>=</span>xxx <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --author<span class=o>=</span>mpas-admin <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --maintainers<span class=o>=</span><span class=nv>$GITHUB_USER</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --prune <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --personal <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --export  &gt;&gt; ./clusters/my-cluster/podinfo/project.yaml</span></span></code></pre></div></figure></div><p>Then, apply the project to the cluster in a GitOps fashion:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git add --all <span class=o>&amp;&amp;</span> git commit -m <span class=s2>&#34;Add podinfo project&#34;</span> <span class=o>&amp;&amp;</span> git push</span></span></code></pre></div></figure></div><p><code>Flux</code> will detect the changes and apply the project to the cluster.</p><p>This will create a <code>namespace</code> for the project, a <code>serviceaccount</code>, and RBAC in the cluster.
It will also create a GitHub repository for the project, and configure <code>Flux</code> to manage the project&rsquo;s resources.</p><ol start=3><li>Add the needed secrets to the namespace</li></ol><p><code>Flux</code> is used to deploy all workloads in a GitOps way. <code>Flux</code> needs a secret in
the project namespace that will be used to communicate with github:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create secret generic <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  github-access <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --from-literal<span class=o>=</span><span class=nv>username</span><span class=o>=</span><span class=nv>$GITHUB_USER</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --from-literal<span class=o>=</span><span class=nv>password</span><span class=o>=</span><span class=nv>$GITHUB_TOKEN</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -n mpas-podinfo-application</span></span></code></pre></div></figure></div><p><strong>Note</strong> The credentials should have access to GitHub packages.</p><p>As part of step 2, a <code>serviceaccount</code> was created for the project. We will use this service account
to provide the necessary permissions to pull from the <code>ghcr</code> registry.</p><p>First, create a secret containing the credentials for the service account:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create secret docker-registry github-registry-key --docker-server<span class=o>=</span>ghcr.io <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --docker-username<span class=o>=</span><span class=nv>$GITHUB_USER</span> --docker-password<span class=o>=</span><span class=nv>$GITHUB_TOKEN</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --docker-email<span class=o>=</span><span class=nv>$MY_EMAIL</span> -n mpas-podinfo-application</span></span></code></pre></div></figure></div><p>Then, patch the service account to use the secret:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl patch serviceaccount mpas-podinfo-application -p <span class=s1>&#39;{&#34;imagePullSecrets&#34;: [{&#34;name&#34;: &#34;github-registry-key&#34;}]}&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -n mpas-podinfo-application</span></span></code></pre></div></figure></div><ol><li>Clone the project repository</li></ol><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/<span class=nv>$GITHUB_USER</span>/mpas-podinfo-application
</span></span><span class=line><span class=cl><span class=nb>cd</span> mpas-podinfo-application</span></span></code></pre></div></figure></div><ol start=5><li>Add the podinfo <code>ComponentSubscription</code></li></ol><p>Create a file under <code>./subscriptions/</code> that will contain the subscription declaration.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mpas create cs podinfo-subscription <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --component<span class=o>=</span>ocm.software/mpas/podinfo <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --semver<span class=o>=</span><span class=s2>&#34;&gt;=v1.0.0&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --source-url<span class=o>=</span>ghcr.io/open-component-model/mpas <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --source-secret-ref<span class=o>=</span>github-access <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --target-url<span class=o>=</span>ghcr.io/<span class=nv>$GITHUB_USER</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --target-secret-ref<span class=o>=</span>github-access <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --namespace<span class=o>=</span>mpas-podinfo-application  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --export &gt;&gt; ./subscriptions/podinfo.yaml</span></span></code></pre></div></figure></div><p>Then, apply the <code>ComponentSubscription</code> to the project in a GitOps fashion:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git add --all <span class=o>&amp;&amp;</span> git commit -m <span class=s2>&#34;Add podinfo subscription&#34;</span> <span class=o>&amp;&amp;</span> git push</span></span></code></pre></div></figure></div><p><code>Flux</code> will detect the changes and apply the subscription to the cluster.</p><p>This will replicate the product referenced by the field <code>spec.component</code> in the <code>ComponentSubscription</code> resource from
the defined registry in <code>spec.source.url</code> to the <code>spec.destination.url</code> registry.</p><ol start=6><li>Add a <code>Target</code> for the podinfo application</li></ol><p>The target will define where the application will be installed</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;&gt; ./targets/podinfo.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: mpas.ocm.software/v1alpha1
</span></span></span><span class=line><span class=cl><span class=s>kind: Target
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: podinfo-kubernetes-target
</span></span></span><span class=line><span class=cl><span class=s>  namespace: mpas-podinfo-application
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    target.mpas.ocm.software/ingress-enabled: &#34;true&#34; # This label is defined by the component that will use it to select an appropriate target to deploy to.
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  type: kubernetes
</span></span></span><span class=line><span class=cl><span class=s>  access:
</span></span></span><span class=line><span class=cl><span class=s>    targetNamespace: podinfo
</span></span></span><span class=line><span class=cl><span class=s>  serviceAccountName: podinfo-sa
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      mpas.ocm.software/target-selector: podinfo-kubernetes-target
</span></span></span><span class=line><span class=cl><span class=s>  interval: 5m0s
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></div></figure></div><p>Then, apply the <code>Target</code> to the project in a GitOps fashion:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git add --all <span class=o>&amp;&amp;</span> git commit -m <span class=s2>&#34;Add a target for podinfo&#34;</span> <span class=o>&amp;&amp;</span> git push</span></span></code></pre></div></figure></div><p><code>Flux</code> will detect the changes and apply the target to the cluster.</p><p>In order for the <code>Target</code> to reach a <code>Ready</code> state, the needed secrets should be created in the <code>podinfo</code> namespace.</p><p>First, create a secret containing the credentials for the service account:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create secret docker-registry github-registry-key --docker-server<span class=o>=</span>ghcr.io <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --docker-username<span class=o>=</span><span class=nv>$GITHUB_USER</span> --docker-password<span class=o>=</span><span class=nv>$GITHUB_TOKEN</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --docker-email<span class=o>=</span><span class=nv>$MY_EMAIL</span> -n podinfo</span></span></code></pre></div></figure></div><p>Then, add a label to allow the target to select it using the label selector:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl label secret github-registry-key mpas.ocm.software/target-selector<span class=o>=</span>podinfo-kubernetes-target -n podinfo</span></span></code></pre></div></figure></div><ol><li>Deploy the podinfo application</li></ol><p>In order to deploy the podinfo application, we need to create a <code>ProductDeploymentGenerator</code> resource:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mpas create pdg podinfo <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --service-account<span class=o>=</span>mpas-podinfo-application <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --subscription-name<span class=o>=</span>podinfo-subscription <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --subscription-namespace<span class=o>=</span>mpas-podinfo-application  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --namespace<span class=o>=</span>mpas-podinfo-application <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --export &gt;&gt; ./generators/podinfo.yaml</span></span></code></pre></div></figure></div><p>Then, apply the <code>ProductDeploymentGenerator</code> to the project in a GitOps fashion:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git add --all <span class=o>&amp;&amp;</span> git commit -m <span class=s2>&#34;Add podinfo deployment generator&#34;</span> <span class=o>&amp;&amp;</span> git push</span></span></code></pre></div></figure></div><p><code>Flux</code> will detect the changes and apply the resource to the cluster.</p><p>This will create a pull request in the project repository with the <code>ProductDeployment</code> resource
that will deploy the podinfo application.</p><p>Go to the project repository and retrieve the pull request.
It should contain a <code>ProductDeployment</code> declaration that provides the configuration and
all steps needed to deploy the product, as well as a <code>values.yaml</code> file. The <code>values</code> file
contains values that should be used to configure the different resources that are part of
the product to be deployed. There is a check that should pass before merging the pull request.</p><p>Once the pull request is merged, <code>Flux</code> will detect the changes and deploy the application to the cluster.</p><p>After a moment the <code>ProductDeployment</code> should be deployed successfully.
It is possible to verify this with the command:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>k describe productdeployment -n mpas-podinfo-application</span></span></code></pre></div></figure></div><p>The result should look something like:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Name:         podinfo
</span></span><span class=line><span class=cl>Namespace:    mpas-podinfo-application
</span></span><span class=line><span class=cl>Labels:       kustomize.toolkit.fluxcd.io/name<span class=o>=</span>mpas-podinfo-application-products
</span></span><span class=line><span class=cl>              kustomize.toolkit.fluxcd.io/namespace<span class=o>=</span>mpas-system
</span></span><span class=line><span class=cl>API Version:  mpas.ocm.software/v1alpha1
</span></span><span class=line><span class=cl>Kind:         ProductDeployment
</span></span><span class=line><span class=cl>Metadata:
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Status:
</span></span><span class=line><span class=cl>  Conditions:
</span></span><span class=line><span class=cl>    Last Transition Time:  2023-09-14T10:14:41Z
</span></span><span class=line><span class=cl>    Message:               Reconciliation success
</span></span><span class=line><span class=cl>    Observed Generation:   <span class=m>1</span>
</span></span><span class=line><span class=cl>    Reason:                Succeeded
</span></span><span class=line><span class=cl>    Status:                True
</span></span><span class=line><span class=cl>    Type:                  Ready
</span></span><span class=line><span class=cl>  Observed Generation:     <span class=m>1</span></span></span></code></pre></div></figure></div><p>The application is deployed in the <code>podinfo</code> namespace.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/mpas/installation/ class="stretched-link text-reset text-decoration-none">Installation</a></div><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/privacy/>Privacy Policy</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item><small>© Copyright 2024, <a href=https://www.sap.com/corporate/en/legal/copyright.html>SAP SE </a>and Open Component Model Contributors | <a href=https://www.sap.com/about/legal/trademark.html>Trademark </a>| <a href=/privacy-policy/>Privacy Policy</a> | <a href=https://www.sap.com/corporate/en/legal/terms-of-use.html>Terms of Use</a> | <a href=https://www.sap.com/corporate/en/legal/impressum.html>Legal Disclosure</a></small></li></ul></div></div></div></footer><script async src=/js/app.47b84f3b640408af6efe7bf4add1a36f5b9c6227fbae7b8bcdf0c9ce42fefc54.js integrity="sha256-R7hPO2QECK9u/nv0rdGjb1ucYif7rnuLzfDJzkL+/FQ="></script><script type=text/javascript async src=https://play.vidyard.com/embed/v4.js></script><script async src=/js/flexsearch.b6f80717bc68cd38b6ded7a061f96a73896db6be17a6582f09a63a6040040919.js integrity="sha256-tvgHF7xozTi23tegYflqc4lttr4XplgvCaY6YEAECRk="></script><script async src=/js/search-modal.4e30271fef6fac86c3b4143167e9784bd3f7037ce1045d03a321e7e799e91476.js integrity="sha256-TjAnH+9vrIbDtBQxZ+l4S9P3A3zhBF0DoyHn55npFHY="></script></body></html>